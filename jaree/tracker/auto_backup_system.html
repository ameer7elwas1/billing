<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .backup-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #e9ecef;
        }

        .backup-section h2 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .backup-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .control-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }

        .control-group h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #6f42c1 100%);
        }

        .status-display {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 200px;
            overflow-y: auto;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .backup-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }

        .backup-item {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .backup-item:last-child {
            border-bottom: none;
        }

        .backup-info {
            flex: 1;
        }

        .backup-info h4 {
            color: #495057;
            margin-bottom: 5px;
        }

        .backup-info p {
            color: #6c757d;
            font-size: 0.9em;
        }

        .backup-actions {
            display: flex;
            gap: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .settings-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .setting-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .setting-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }

        .setting-item input, .setting-item select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .content {
                padding: 20px;
            }
            
            .backup-controls {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h1>
            <p>Ø­ÙØ¸ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</p>
        </div>

        <div class="content">
            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… -->
            <div class="backup-section">
                <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalBackups">0</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="lastBackup">--</div>
                        <div class="stat-label">Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="storageUsed">0 MB</div>
                        <div class="stat-label">Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="autoBackupStatus">ØºÙŠØ± Ù…ÙØ¹Ù„</div>
                        <div class="stat-label">Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</div>
                    </div>
                </div>
            </div>

            <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
            <div class="backup-section">
                <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h2>
                <div class="settings-group">
                    <div class="setting-item">
                        <label>ÙØªØ±Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:</label>
                        <select id="backupInterval">
                            <option value="0">Ù…Ø¹Ø·Ù„</option>
                            <option value="1">ÙƒÙ„ Ø³Ø§Ø¹Ø©</option>
                            <option value="6">ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª</option>
                            <option value="12">ÙƒÙ„ 12 Ø³Ø§Ø¹Ø©</option>
                            <option value="24">ÙŠÙˆÙ…ÙŠØ§Ù‹</option>
                            <option value="168">Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©:</label>
                        <input type="number" id="maxBackups" value="10" min="1" max="50">
                    </div>
                    <div class="setting-item">
                        <label>Ø¶ØºØ· Ø§Ù„Ù…Ù„ÙØ§Øª:</label>
                        <select id="compressionLevel">
                            <option value="0">Ø¨Ø¯ÙˆÙ† Ø¶ØºØ·</option>
                            <option value="1">Ø¶ØºØ· Ø®ÙÙŠÙ</option>
                            <option value="2">Ø¶ØºØ· Ù…ØªÙˆØ³Ø·</option>
                            <option value="3">Ø¶ØºØ· Ø¹Ø§Ù„ÙŠ</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>ØªØ´ÙÙŠØ± Ø§Ù„Ù†Ø³Ø®:</label>
                        <select id="encryptionEnabled">
                            <option value="false">ØºÙŠØ± Ù…Ø´ÙØ±Ø©</option>
                            <option value="true">Ù…Ø´ÙØ±Ø©</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-success" onclick="saveSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>

            <!-- Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ÙŠØ¯ÙˆÙŠ -->
            <div class="backup-section">
                <h2>ğŸ”„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ÙŠØ¯ÙˆÙŠ</h2>
                <div class="backup-controls">
                    <div class="control-group">
                        <h3>ğŸ“¥ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h3>
                        <button class="btn btn-success" onclick="createBackup()">ğŸ”„ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                        <button class="btn btn-info" onclick="createFullBackup()">ğŸ“¦ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙƒØ§Ù…Ù„Ø©</button>
                        <button class="btn btn-warning" onclick="createIncrementalBackup()">ğŸ“ˆ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØªØ¯Ø±ÙŠØ¬ÙŠØ©</button>
                    </div>
                    <div class="control-group">
                        <h3>ğŸ“¤ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                        <button class="btn btn-warning" onclick="restoreFromBackup()">ğŸ”„ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù…Ù† Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                        <button class="btn btn-info" onclick="selectBackupFile()">ğŸ“ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                    </div>
                    <div class="control-group">
                        <h3>ğŸ—‘ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø³Ø®</h3>
                        <button class="btn btn-danger" onclick="cleanOldBackups()">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</button>
                        <button class="btn btn-info" onclick="exportBackupList()">ğŸ“‹ ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø®</button>
                    </div>
                    <div class="control-group">
                        <h3>ğŸŒ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©</h3>
                        <button class="btn btn-success" onclick="uploadToCloud()">â˜ï¸ Ø±ÙØ¹ Ù„Ù„Ø³Ø­Ø§Ø¨Ø©</button>
                        <button class="btn btn-info" onclick="downloadFromCloud()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©</button>
                    </div>
                </div>
            </div>

            <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
            <div class="backup-section">
                <h2>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</h2>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="status-display" id="statusDisplay">
                    Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„... âœ…
                </div>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© -->
            <div class="backup-section">
                <h2>ğŸ“‹ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©</h2>
                <div class="backup-list" id="backupList">
                    <div class="backup-item">
                        <div class="backup-info">
                            <h4>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h4>
                            <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        let backupSettings = {
            interval: 24, // Ø³Ø§Ø¹Ø§Øª
            maxBackups: 10,
            compressionLevel: 2,
            encryptionEnabled: true,
            autoBackupEnabled: false
        };

        // Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        let systemStatus = {
            isRunning: false,
            currentOperation: null,
            progress: 0
        };

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        let backupList = [];

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            loadBackupList();
            updateStats();
            startAutoBackup();
        });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function loadSettings() {
            const saved = localStorage.getItem('backupSettings');
            if (saved) {
                backupSettings = JSON.parse(saved);
                document.getElementById('backupInterval').value = backupSettings.interval;
                document.getElementById('maxBackups').value = backupSettings.maxBackups;
                document.getElementById('compressionLevel').value = backupSettings.compressionLevel;
                document.getElementById('encryptionEnabled').value = backupSettings.encryptionEnabled;
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function saveSettings() {
            backupSettings.interval = parseInt(document.getElementById('backupInterval').value);
            backupSettings.maxBackups = parseInt(document.getElementById('maxBackups').value);
            backupSettings.compressionLevel = parseInt(document.getElementById('compressionLevel').value);
            backupSettings.encryptionEnabled = document.getElementById('encryptionEnabled').value === 'true';
            
            localStorage.setItem('backupSettings', JSON.stringify(backupSettings));
            showStatus('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…', 'success');
            
            if (backupSettings.interval > 0) {
                backupSettings.autoBackupEnabled = true;
                startAutoBackup();
            } else {
                backupSettings.autoBackupEnabled = false;
                stopAutoBackup();
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        async function createBackup() {
            if (systemStatus.isRunning) {
                showStatus('Ø¹Ù…Ù„ÙŠØ© Ø£Ø®Ø±Ù‰ Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„... â³', 'warning');
                return;
            }

            systemStatus.isRunning = true;
            systemStatus.currentOperation = 'Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©';
            updateProgress(0);

            try {
                showStatus('Ø¨Ø¯Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©... ğŸ”„', 'info');
                updateProgress(10);

                // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…
                const data = await collectSystemData();
                updateProgress(30);

                // Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const compressedData = await compressData(data);
                updateProgress(50);

                // ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const encryptedData = await encryptData(compressedData);
                updateProgress(70);

                // Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                const backupId = await saveBackup(encryptedData);
                updateProgress(90);

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                await loadBackupList();
                updateProgress(100);

                showStatus(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰ (ID: ${backupId})`, 'success');
                
            } catch (error) {
                showStatus(`Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${error.message} âŒ`, 'error');
            } finally {
                systemStatus.isRunning = false;
                systemStatus.currentOperation = null;
                setTimeout(() => updateProgress(0), 2000);
            }
        }

        // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        async function collectSystemData() {
            const data = {
                timestamp: new Date().toISOString(),
                version: '1.0.0',
                users: [],
                centers: [],
                employees: [],
                logs: [],
                settings: backupSettings
            };

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø³ØªØ¬Ù…Ø¹ Ù…Ù† Supabase)
            data.users = [
                { id: 1, username: 'admin', full_name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…', role: 'admin' },
                { id: 2, username: 'user1', full_name: 'Ù…Ø³ØªØ®Ø¯Ù… 1', role: 'user' }
            ];

            data.centers = [
                { id: 1, name: 'Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', latitude: 32.6155, longitude: 44.0240 }
            ];

            data.employees = [
                { id: 1, name: 'Ù…ÙˆØ¸Ù 1', phone: '07701234567', center_id: 1 }
            ];

            return data;
        }

        // Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function compressData(data) {
            const jsonString = JSON.stringify(data);
            
            if (backupSettings.compressionLevel === 0) {
                return jsonString;
            }

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¶ØºØ· (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙƒØªØ¨Ø© Ø¶ØºØ·)
            return btoa(jsonString);
        }

        // ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function encryptData(data) {
            if (!backupSettings.encryptionEnabled) {
                return data;
            }

            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ´ÙÙŠØ± (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ù…ÙƒØªØ¨Ø© ØªØ´ÙÙŠØ±)
            return btoa(data);
        }

        // Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        async function saveBackup(data) {
            const backupId = 'backup_' + Date.now();
            const backup = {
                id: backupId,
                timestamp: new Date().toISOString(),
                size: new Blob([data]).size,
                type: 'manual',
                data: data
            };

            // Ø­ÙØ¸ ÙÙŠ localStorage (ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø§Ø­ÙØ¸ ÙÙŠ Ù…Ù„Ù Ø£Ùˆ Ø³Ø­Ø§Ø¨Ø©)
            const backups = JSON.parse(localStorage.getItem('backups') || '[]');
            backups.push(backup);
            localStorage.setItem('backups', JSON.stringify(backups));

            return backupId;
        }

        // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        async function loadBackupList() {
            const backups = JSON.parse(localStorage.getItem('backups') || '[]');
            backupList = backups;
            
            const listContainer = document.getElementById('backupList');
            listContainer.innerHTML = '';

            if (backups.length === 0) {
                listContainer.innerHTML = '<div class="backup-item"><div class="backup-info"><h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</h4><p>Ø£Ù†Ø´Ø¦ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹</p></div></div>';
                return;
            }

            backups.reverse().forEach(backup => {
                const item = document.createElement('div');
                item.className = 'backup-item';
                item.innerHTML = `
                    <div class="backup-info">
                        <h4>${backup.id}</h4>
                        <p>ØªØ§Ø±ÙŠØ®: ${new Date(backup.timestamp).toLocaleString('ar-SA')} | Ø§Ù„Ø­Ø¬Ù…: ${formatFileSize(backup.size)} | Ø§Ù„Ù†ÙˆØ¹: ${backup.type}</p>
                    </div>
                    <div class="backup-actions">
                        <button class="btn btn-info" onclick="downloadBackup('${backup.id}')">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„</button>
                        <button class="btn btn-warning" onclick="restoreBackup('${backup.id}')">ğŸ”„ Ø§Ø³ØªØ¹Ø§Ø¯Ø©</button>
                        <button class="btn btn-danger" onclick="deleteBackup('${backup.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateStats() {
            const backups = JSON.parse(localStorage.getItem('backups') || '[]');
            
            document.getElementById('totalBackups').textContent = backups.length;
            
            if (backups.length > 0) {
                const lastBackup = backups[backups.length - 1];
                document.getElementById('lastBackup').textContent = new Date(lastBackup.timestamp).toLocaleDateString('ar-SA');
                
                const totalSize = backups.reduce((sum, backup) => sum + backup.size, 0);
                document.getElementById('storageUsed').textContent = formatFileSize(totalSize);
            } else {
                document.getElementById('lastBackup').textContent = '--';
                document.getElementById('storageUsed').textContent = '0 MB';
            }
            
            document.getElementById('autoBackupStatus').textContent = backupSettings.autoBackupEnabled ? 'Ù…ÙØ¹Ù„' : 'ØºÙŠØ± Ù…ÙØ¹Ù„';
        }

        // Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        let autoBackupInterval;

        function startAutoBackup() {
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
            }

            if (backupSettings.autoBackupEnabled && backupSettings.interval > 0) {
                const intervalMs = backupSettings.interval * 60 * 60 * 1000; // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø¥Ù„Ù‰ Ù…ÙŠÙ„ÙŠ Ø«Ø§Ù†ÙŠØ©
                
                autoBackupInterval = setInterval(() => {
                    showStatus('Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ... ğŸ¤–', 'info');
                    createBackup();
                }, intervalMs);

                showStatus(`ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ ${backupSettings.interval} Ø³Ø§Ø¹Ø© âœ…`, 'success');
            }
        }

        function stopAutoBackup() {
            if (autoBackupInterval) {
                clearInterval(autoBackupInterval);
                autoBackupInterval = null;
            }
            showStatus('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ â¹ï¸', 'warning');
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        function updateProgress(percent) {
            document.getElementById('progressFill').style.width = percent + '%';
        }

        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
        function showStatus(message, type = 'info') {
            const statusDisplay = document.getElementById('statusDisplay');
            statusDisplay.textContent = message;
            statusDisplay.className = `status-display status-${type}`;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            updateStats();
        }

        // ØªÙ†Ø³ÙŠÙ‚ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙÙŠØ©
        function createFullBackup() {
            showStatus('Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙƒØ§Ù…Ù„Ø©... ğŸ“¦', 'info');
            createBackup();
        }

        function createIncrementalBackup() {
            showStatus('Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØªØ¯Ø±ÙŠØ¬ÙŠØ©... ğŸ“ˆ', 'info');
            createBackup();
        }

        function restoreFromBackup() {
            showStatus('Ø§Ø®ØªØ± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©... ğŸ”„', 'info');
            // ØªÙ†ÙÙŠØ° Ù…Ù†Ø·Ù‚ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
        }

        function selectBackupFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,.backup';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    showStatus(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù: ${file.name} ğŸ“`, 'success');
                    // ØªÙ†ÙÙŠØ° Ù…Ù†Ø·Ù‚ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                }
            };
            input.click();
        }

        function cleanOldBackups() {
            const backups = JSON.parse(localStorage.getItem('backups') || '[]');
            if (backups.length > backupSettings.maxBackups) {
                const toDelete = backups.length - backupSettings.maxBackups;
                backups.splice(0, toDelete);
                localStorage.setItem('backups', JSON.stringify(backups));
                showStatus(`ØªÙ… Ø­Ø°Ù ${toDelete} Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù‚Ø¯ÙŠÙ…Ø© ğŸ§¹`, 'success');
                loadBackupList();
            } else {
                showStatus('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù‚Ø¯ÙŠÙ…Ø© Ù„Ù„Ø­Ø°Ù âœ…', 'info');
            }
        }

        function exportBackupList() {
            const backups = JSON.parse(localStorage.getItem('backups') || '[]');
            const exportData = {
                exportDate: new Date().toISOString(),
                totalBackups: backups.length,
                backups: backups.map(b => ({
                    id: b.id,
                    timestamp: b.timestamp,
                    size: b.size,
                    type: b.type
                }))
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_list_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            showStatus('ØªÙ… ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ğŸ“‹', 'success');
        }

        function uploadToCloud() {
            showStatus('Ø±ÙØ¹ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ø³Ø­Ø§Ø¨Ø©... â˜ï¸', 'info');
            // ØªÙ†ÙÙŠØ° Ù…Ù†Ø·Ù‚ Ø§Ù„Ø±ÙØ¹ Ù„Ù„Ø³Ø­Ø§Ø¨Ø©
        }

        function downloadFromCloud() {
            showStatus('ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©... â¬‡ï¸', 'info');
            // ØªÙ†ÙÙŠØ° Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
        }

        function downloadBackup(backupId) {
            const backup = backupList.find(b => b.id === backupId);
            if (backup) {
                const blob = new Blob([backup.data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${backupId}.backup`;
                a.click();
                URL.revokeObjectURL(url);
                showStatus(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${backupId} â¬‡ï¸`, 'success');
            }
        }

        function restoreBackup(backupId) {
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${backupId}ØŸ\nØ³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©!`)) {
                showStatus(`Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${backupId}... ğŸ”„`, 'warning');
                // ØªÙ†ÙÙŠØ° Ù…Ù†Ø·Ù‚ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø©
            }
        }

        function deleteBackup(backupId) {
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${backupId}ØŸ`)) {
                const backups = JSON.parse(localStorage.getItem('backups') || '[]');
                const filteredBackups = backups.filter(b => b.id !== backupId);
                localStorage.setItem('backups', JSON.stringify(filteredBackups));
                showStatus(`ØªÙ… Ø­Ø°Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: ${backupId} ğŸ—‘ï¸`, 'success');
                loadBackupList();
            }
        }
    </script>
</body>
</html>
