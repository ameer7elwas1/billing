<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRAQCELL</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js">
function updateAgentSummary() {
    let summaryHTML = `<div class="section"><h3 class="section-title">ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</h3><div class="results-grid">`;
    Object.entries(agentReports).forEach(([agentName, report]) => {
        let totalBasic = report.basic?.total.amount || 0;
        let totalAdvanced = report.advanced?.total.profit || 0;
        let totalAll = totalBasic + totalAdvanced;
        summaryHTML += `
            <div class="result-card">
                <h3>ğŸ‘¤ ${agentName}</h3>
                <div class="amount">ğŸ’° Ù…Ø¬Ø§Ù†ÙŠ: ${formatNumber(totalBasic)} Ø¯.Ø¹</div>
                <div class="amount">ğŸ’¼ Ù…Ø®ÙØ¶: ${formatNumber(totalAdvanced)} Ø¯.Ø¹</div>
                <div class="amount">ğŸ“Š Ø§Ù„ÙƒÙ„ÙŠ: ${formatNumber(totalAll)} Ø¯.Ø¹</div>
            </div>`;
    });
    summaryHTML += `</div></div>`;

    let existing = document.getElementById('agentSummary');
    if (existing) existing.remove();

    const summaryContainer = document.createElement('div');
    summaryContainer.id = 'agentSummary';
    summaryContainer.innerHTML = summaryHTML;
    document.getElementById('dashboard').appendChild(summaryContainer);
}

</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js">
function updateAgentSummary() {
    let summaryHTML = `<div class="section"><h3 class="section-title">ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡</h3><div class="results-grid">`;
    Object.entries(agentReports).forEach(([agentName, report]) => {
        let totalBasic = report.basic?.total.amount || 0;
        let totalAdvanced = report.advanced?.total.profit || 0;
        let totalAll = totalBasic + totalAdvanced;
        summaryHTML += `
            <div class="result-card">
                <h3>ğŸ‘¤ ${agentName}</h3>
                <div class="amount">ğŸ’° Ù…Ø¬Ø§Ù†ÙŠ: ${formatNumber(totalBasic)} Ø¯.Ø¹</div>
                <div class="amount">ğŸ’¼ Ù…Ø®ÙØ¶: ${formatNumber(totalAdvanced)} Ø¯.Ø¹</div>
                <div class="amount">ğŸ“Š Ø§Ù„ÙƒÙ„ÙŠ: ${formatNumber(totalAll)} Ø¯.Ø¹</div>
            </div>`;
    });
    summaryHTML += `</div></div>`;

    let existing = document.getElementById('agentSummary');
    if (existing) existing.remove();

    const summaryContainer = document.createElement('div');
    summaryContainer.id = 'agentSummary';
    summaryContainer.innerHTML = summaryHTML;
    document.getElementById('dashboard').appendChild(summaryContainer);
}

</script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(128, 28, 50, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(128, 28, 50, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            display: flex;
            width: 100%;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        .sidebar {
            width: 280px;
            background: #ffffff;
            border-left: 2px solid #801c32;
            box-shadow: 4px 0 20px rgba(128, 28, 50, 0.15);
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            padding: 30px 0;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 25px 30px;
            border-bottom: 2px solid #801c32;
            margin-bottom: 20px;
        }

        .sidebar-header h1 {
            font-size: 2rem;
            color: #801c32;
            font-weight: 900;
            text-align: center;
            letter-spacing: 2px;
        }

        .sidebar-nav {
            flex: 1;
            padding: 0 15px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 18px 20px;
            margin-bottom: 10px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333333;
            font-weight: 600;
            font-size: 15px;
            position: relative;
            overflow: hidden;
            background: #ffffff;
            border: 1px solid #e0e0e0;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: #801c32;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .nav-item:hover::before,
        .nav-item.active::before {
            transform: translateX(0);
        }

        .nav-item:hover {
            background: rgba(128, 28, 50, 0.05);
            border-color: #801c32;
            transform: translateX(-5px);
            box-shadow: 0 4px 15px rgba(128, 28, 50, 0.1);
        }

        .nav-item.active {
            background: rgba(128, 28, 50, 0.1);
            border-color: #801c32;
            color: #801c32;
            box-shadow: 0 4px 20px rgba(128, 28, 50, 0.15);
            transform: translateX(-5px);
        }

        .nav-icon {
            font-size: 1.5rem;
            width: 35px;
            text-align: center;
        }

        .nav-text {
            flex: 1;
        }

        .sidebar-footer {
            padding: 20px 25px;
            border-top: 2px solid #801c32;
            margin-top: 20px;
        }

        .user-info-sidebar {
            color: #801c32;
            font-size: 14px;
            text-align: center;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .date-info-sidebar {
            color: #666666;
            font-size: 12px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            margin-right: 280px;
            padding: 40px;
            min-height: 100vh;
        }

        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            width: 100%;
        }

        .login-form {
            background: #ffffff;
            padding: 60px 50px;
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(128, 28, 50, 0.2);
            width: 100%;
            max-width: 480px;
            text-align: center;
            border: 3px solid #801c32;
            position: relative;
            overflow: hidden;
        }

        .login-form::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #801c32;
        }

        .login-logo {
            font-size: 3.5rem;
            color: #801c32;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .login-title {
            font-size: 1.8rem;
            color: #801c32;
            margin-bottom: 35px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: right;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333333;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
            text-align: right;
            background: #ffffff;
        }

        .form-group input:focus {
            outline: none;
            border-color: #801c32;
            box-shadow: 0 0 20px rgba(128, 28, 50, 0.2);
            transform: translateY(-2px);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: #801c32;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(128, 28, 50, 0.3);
        }

        .login-btn:hover {
            transform: translateY(-3px);
            background: #6a1628;
            box-shadow: 0 12px 35px rgba(128, 28, 50, 0.4);
        }

        .login-btn:active {
            transform: translateY(-1px);
        }

        .dashboard {
            display: none;
            width: 100%;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-content.active {
            display: block;
        }

        .section {
            background: #ffffff;
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            box-shadow: 
                0 10px 30px rgba(128, 28, 50, 0.1),
                0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(128, 28, 50, 0.05) 50%,
                transparent 70%
            );
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }

        .section:hover::before {
            animation: shine 1.5s ease-in-out;
            opacity: 1;
        }

        @keyframes shine {
            0% { transform: rotate(45deg) translateX(-100%) translateY(-100%); }
            100% { transform: rotate(45deg) translateX(100%) translateY(100%); }
        }

        .section:hover {
            transform: translateY(-8px) scale(1.01);
            box-shadow: 
                0 20px 50px rgba(128, 28, 50, 0.15),
                0 10px 30px rgba(0, 0, 0, 0.1);
            border-color: #801c32;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 900;
            color: #801c32;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #801c32;
            display: flex;
            align-items: center;
            gap: 15px;
            letter-spacing: 1px;
            position: relative;
        }

        .file-upload {
            border: 3px dashed #801c32;
            border-radius: 20px;
            padding: 50px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-bottom: 30px;
            background: rgba(128, 28, 50, 0.05);
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 10px 30px rgba(128, 28, 50, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .file-upload::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(128, 28, 50, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .file-upload:hover::before {
            left: 100%;
        }

        .file-upload:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 
                0 20px 50px rgba(128, 28, 50, 0.15),
                0 10px 30px rgba(128, 28, 50, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            background: rgba(128, 28, 50, 0.1);
            border-color: #801c32;
        }

        .file-upload.dragover {
            transform: scale(1.05);
            box-shadow: 
                0 25px 60px rgba(128, 28, 50, 0.2),
                0 15px 40px rgba(128, 28, 50, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            border-color: #801c32;
        }

        .file-upload p {
            margin: 0;
            font-size: 1.15rem;
            font-weight: 700;
            color: #801c32;
            position: relative;
            z-index: 2;
            letter-spacing: 0.8px;
        }

        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 800;
            margin: 10px 8px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.15),
                0 4px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #ffffff;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.6s ease;
        }

        .btn:active::before {
            width: 400px;
            height: 400px;
        }

        .btn-primary {
            background: #801c32;
            box-shadow: 
                0 8px 25px rgba(128, 28, 50, 0.4),
                0 4px 15px rgba(128, 28, 50, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-5px) scale(1.05);
            background: #6a1628;
            box-shadow: 
                0 15px 40px rgba(128, 28, 50, 0.5),
                0 8px 25px rgba(128, 28, 50, 0.4);
        }

        .btn-success {
            background: #801c32;
            box-shadow: 
                0 8px 25px rgba(128, 28, 50, 0.4),
                0 4px 15px rgba(128, 28, 50, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-5px) scale(1.05);
            background: #6a1628;
            box-shadow: 
                0 15px 40px rgba(128, 28, 50, 0.5),
                0 8px 25px rgba(128, 28, 50, 0.4);
        }

        .btn-warning {
            background: #801c32;
            box-shadow: 
                0 8px 25px rgba(128, 28, 50, 0.4),
                0 4px 15px rgba(128, 28, 50, 0.3);
        }

        .btn-warning:hover {
            transform: translateY(-5px) scale(1.05);
            background: #6a1628;
            box-shadow: 
                0 15px 40px rgba(128, 28, 50, 0.5),
                0 8px 25px rgba(128, 28, 50, 0.4);
        }

        .btn-danger {
            background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);
            color: #ffffff;
            border-color: rgba(239, 68, 68, 0.5);
        }

        .btn-danger:hover {
            background: linear-gradient(180deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(239, 68, 68, 0.4),
                0 0 20px rgba(239, 68, 68, 0.3);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 10px;
        }

        .result-card {
            background: #ffffff;
            border-radius: 15px;
            padding: 18px 15px;
            text-align: center;
            box-shadow: 
                0 6px 20px rgba(128, 28, 50, 0.1),
                0 3px 10px rgba(0, 0, 0, 0.05);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(128, 28, 50, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .result-card:hover::before {
            left: 100%;
        }

        .result-card:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 
                0 12px 30px rgba(128, 28, 50, 0.15),
                0 6px 20px rgba(128, 28, 50, 0.1);
            border-color: #801c32;
        }

        .result-card.bronze {
            border-top: 3px solid #f59e0b;
        }

        .result-card.silver {
            border-top: 3px solid #94a3b8;
        }

        .result-card.gold {
            border-top: 3px solid #fbbf24;
        }

        .result-card.platinum {
            border-top: 3px solid #a855f7;
        }

        .result-card h3 {
            color: #801c32;
            margin-bottom: 10px;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            position: relative;
            z-index: 2;
            text-transform: uppercase;
        }

        .result-card .count {
            font-size: 2rem;
            font-weight: 900;
            color: #801c32;
            margin-bottom: 12px;
            line-height: 1.1;
            position: relative;
            z-index: 2;
        }

        .result-card .amount {
            color: #333333;
            font-weight: 600;
            font-size: 0.9rem;
            position: relative;
            z-index: 2;
            margin: 8px 0;
            padding: 6px 0;
            border-top: 1px solid #e0e0e0;
        }

        .result-card .amount:first-of-type {
            border-top: none;
        }

        .agent-info {
            background: #ffffff;
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 
                0 15px 40px rgba(128, 28, 50, 0.1),
                0 8px 25px rgba(128, 28, 50, 0.15);
            position: relative;
            overflow: hidden;
            border: 3px solid #801c32;
        }

        .agent-info::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(128, 28, 50, 0.05), transparent);
            transform: rotate(45deg);
            animation: float 8s ease-in-out infinite;
        }

        .agent-info h3 {
            margin-bottom: 25px;
            font-size: 2rem;
            font-weight: 900;
            position: relative;
            z-index: 2;
            color: #801c32;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .agent-info p {
            position: relative;
            z-index: 2;
            font-size: 1.15rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333333;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 60px 40px;
            background: #ffffff;
            border-radius: 25px;
            margin: 30px 0;
            box-shadow: 
                0 15px 40px rgba(128, 28, 50, 0.1),
                0 8px 25px rgba(128, 28, 50, 0.15);
            border: 3px solid #801c32;
        }

        .spinner {
            border: 5px solid rgba(128, 28, 50, 0.2);
            border-top: 5px solid #801c32;
            border-right: 5px solid #801c32;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
            box-shadow: 
                0 0 30px rgba(128, 28, 50, 0.4),
                0 6px 20px rgba(0, 0, 0, 0.2);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            color: #801c32;
            font-weight: 800;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        .error-message {
            background: #ffffff;
            color: #e53e3e;
            padding: 20px 30px;
            border-radius: 20px;
            margin: 25px 0;
            border: 3px solid #e53e3e;
            font-weight: 800;
            font-size: 1.1rem;
            box-shadow: 
                0 10px 30px rgba(229, 62, 62, 0.2),
                0 5px 15px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.5px;
        }

        .success-message {
            background: #ffffff;
            color: #801c32;
            padding: 20px 30px;
            border-radius: 20px;
            margin: 25px 0;
            border: 3px solid #801c32;
            font-weight: 800;
            font-size: 1.1rem;
            box-shadow: 
                0 10px 30px rgba(128, 28, 50, 0.2),
                0 5px 15px rgba(0, 0, 0, 0.1);
            animation: fadeInUp 0.5s ease;
            letter-spacing: 0.5px;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: relative;
                height: auto;
                border-left: none;
                border-bottom: 2px solid #801c32;
            }

            .main-content {
                margin-right: 0;
                padding: 20px;
            }

            .results-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .section {
                padding: 25px 20px;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .btn {
                padding: 12px 24px;
                font-size: 14px;
                margin: 8px 4px;
            }

            .file-upload {
                padding: 30px 20px;
            }

            .login-form {
                margin: 20px;
                padding: 40px 25px;
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .section:nth-child(odd) {
            animation: slideInLeft 0.6s ease-out;
        }

        .section:nth-child(even) {
            animation: slideInRight 0.6s ease-out;
        }

        .date-time-bar {
            width: 100%;
            text-align: center;
            margin: 10px 0 0 0;
        }
        #currentDateTime {
            font-size: 1.3rem;
            font-weight: 700;
            color: #801c32;
            background: #ffffff;
            padding: 12px 28px;
            border-radius: 8px;
            display: inline-block;
            letter-spacing: 2px;
            box-shadow: 
                0 4px 15px rgba(128, 28, 50, 0.15),
                0 0 0 1px rgba(128, 28, 50, 0.2);
            position: relative;
            z-index: 2;
            margin-top: 15px;
            border: 2px solid #801c32;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            
            .dashboard, 
            .dashboard * {
                visibility: visible;
            }
            
            .login-screen {
                display: none !important;
            }
            
            .dashboard {
                display: block !important;
            }
            
            .header {
                background: #667eea !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            
            .tabs {
                display: none;
            }
            
            .tab-content {
                display: block !important;
            }
            
            .tab-content:not(.active) {
                display: none !important;
            }
            
            .btn {
                display: none;
            }
            
            .file-upload {
                display: none;
            }
            
            .results-grid {
                break-inside: avoid;
                page-break-inside: avoid;
            }
            
            .result-card {
                break-inside: avoid;
                page-break-inside: avoid;
                border: 1px solid #ccc !important;
            }
            
            .agent-info {
                background: #28a745 !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
        }

        .sidebar-header .author-name {
            font-size: 1.1rem;
            font-weight: 500;
            color: #2C5F8D;
            text-align: center;
            margin-top: 12px;
            letter-spacing: 2px;
            padding: 10px 18px;
            background: linear-gradient(135deg, rgba(44, 95, 141, 0.1) 0%, rgba(44, 95, 141, 0.15) 100%);
            border-radius: 12px;
            border: 2px solid rgba(44, 95, 141, 0.3);
            display: inline-block;
            width: calc(100% - 30px);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(44, 95, 141, 0.1);
        }

        .sidebar-header .author-name:hover {
            background: linear-gradient(135deg, rgba(44, 95, 141, 0.15) 0%, rgba(44, 95, 141, 0.2) 100%);
            border-color: rgba(44, 95, 141, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(44, 95, 141, 0.25);
            color: #1e4a6b;
            cursor: pointer;
        }

        .author-info-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffffff;
            border-radius: 20px;
            padding: 30px 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 3px solid #2C5F8D;
            z-index: 10001;
            min-width: 450px;
            max-width: 650px;
            width: auto;
            animation: popupFadeIn 0.3s ease;
        }

        .author-info-popup.show {
            display: block;
        }

        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            backdrop-filter: blur(4px);
        }

        .popup-overlay.show {
            display: block;
        }

        .popup-header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #2C5F8D;
            padding-bottom: 15px;
        }

        .popup-header h2 {
            color: #2C5F8D;
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .popup-content {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: rgba(44, 95, 141, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(44, 95, 141, 0.15);
            transition: all 0.3s ease;
            flex-direction: row-reverse;
        }

        .info-item:hover {
            background: rgba(44, 95, 141, 0.1);
            border-color: rgba(44, 95, 141, 0.3);
            transform: translateX(-5px);
        }

        .info-icon {
            font-size: 1.3rem;
            width: 35px;
            text-align: center;
            flex-shrink: 0;
        }

        .info-text {
            flex: 0 0 auto;
            color: #333333;
            font-size: 0.9rem;
            font-weight: 600;
            min-width: 120px;
            text-align: left;
        }

        .info-value {
            color: #2C5F8D;
            font-weight: 700;
            font-size: 0.95rem;
            flex: 1;
            text-align: left;
            direction: ltr;
            white-space: nowrap;
        }

        .info-action {
            padding: 6px 14px;
            background: #2C5F8D;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            font-weight: 700;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .info-action:hover {
            background: #1e4a6b;
            transform: scale(1.05);
        }

        .popup-close {
            position: absolute;
            top: 15px;
            left: 15px;
            background: transparent;
            border: none;
            font-size: 1.5rem;
            color: #2C5F8D;
            cursor: pointer;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .popup-close:hover {
            background: rgba(44, 95, 141, 0.1);
            transform: rotate(90deg);
        }

        /* Settings Styles */
        .settings-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .settings-section {
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(128, 28, 50, 0.1);
            border: 1px solid rgba(128, 28, 50, 0.2);
        }

        .settings-section h4 {
            color: #801c32;
            margin-bottom: 15px;
            font-size: 1.1rem;
            border-bottom: 2px solid rgba(128, 28, 50, 0.2);
            padding-bottom: 10px;
        }

        .settings-group {
            margin-bottom: 15px;
        }

        .settings-group label {
            display: block;
            color: #333;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .settings-input {
            width: 100%;
            padding: 10px;
            border: 2px solid rgba(128, 28, 50, 0.3);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .settings-input:focus {
            outline: none;
            border-color: #801c32;
            box-shadow: 0 0 0 3px rgba(128, 28, 50, 0.1);
        }

        .settings-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .settings-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* Activity Log Styles */
        .activity-log-container {
            background: #ffffff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(128, 28, 50, 0.1);
            border: 1px solid rgba(128, 28, 50, 0.2);
            max-height: 600px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(128, 28, 50, 0.05);
            border-radius: 8px;
            border-right: 4px solid #801c32;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background: rgba(128, 28, 50, 0.1);
            transform: translateX(-3px);
        }

        .activity-item .activity-icon {
            font-size: 1.5rem;
            margin-left: 10px;
        }

        .activity-item .activity-details {
            flex: 1;
        }

        .activity-item .activity-time {
            color: #666;
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div id="dashboard" class="dashboard">
            <div class="sidebar">
                <div class="sidebar-header">
                <h1>IRAQCELL</h1>
                    <div class="author-name" onclick="showAuthorInfo()">Ameer Helwas</div>
                </div>
                <div class="sidebar-nav">
                    <div class="nav-item active" onclick="switchTab('basic')">
                        <span class="nav-icon"></span>
                        <span class="nav-text">Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</span>
                </div>
                    <div class="nav-item" onclick="switchTab('advanced')">
                        <span class="nav-icon"></span>
                        <span class="nav-text">3 Ø£Ø´Ù‡Ø± Ù…Ø®ÙØ¶</span>
            </div>
                    <div class="nav-item" onclick="switchTab('twoMonths')">
                        <span class="nav-icon"></span>
                        <span class="nav-text">Ø´Ù‡Ø±ÙŠÙ† Ù…Ø®ÙØ¶</span>
                    </div>
                    <div class="nav-item" onclick="switchTab('summary')">
                        <span class="nav-icon"></span>
                        <span class="nav-text">Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø§Ù…</span>
                    </div>
                    <div class="nav-item" onclick="switchTab('settings')">
                        <span class="nav-icon"></span>
                        <span class="nav-text">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                    </div>
                    <div class="nav-item" onclick="switchTab('activity')">
                        <span class="nav-icon"></span>
                        <span class="nav-text">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</span>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <div class="user-info-sidebar">
                        <span id="currentUser">Ù…Ø±Ø­Ø¨Ø§Ù‹</span>
                    </div>
                    <div class="date-info-sidebar" id="currentDateTime"></div>
                </div>
            </div>

            <div class="main-content">

            <div id="basicTab" class="tab-content active">
                <div class="section">
                    <h3 class="section-title">
                         Ø±ÙØ¹ Excel Ø§Ù„ÙˆÙƒÙŠÙ„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ
                    </h3>
                    <div class="file-upload" id="basicFileUpload">
                        <p>ğŸ“„ Ø§Ø³Ø­Ø¨ Ù…Ù„Ù Excel Ø£Ùˆ CSV Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                        <input type="file" id="basicFileInput" accept=".xlsx,.xls,.csv" style="display: none;">
                    </div>
                    <div id="basicFileName" class="success-message hidden"></div>
                </div>

                <div class="section">
                    <h3 class="section-title">
                         ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ
                    </h3>
                    <p style="color: #666; margin-bottom: 15px; font-size: 1rem;">
                    
                    </p>
                    <button class="btn btn-primary" onclick="analyzeBasicData()">
                         ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    </button>
                    <button class="btn btn-warning" onclick="resetBasicResults()">
                         Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                    </button>
                </div>

                <div id="basicResults" class="section hidden">
                    <h3 class="section-title">
                         Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ
                    </h3>
                    <div id="basicAgentInfo" class="agent-info"></div>
                    <div class="results-grid" id="basicResultsGrid"></div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveBasicReport()">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button class="btn btn-primary" onclick="printBasicReport()">
                            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button class="btn btn-warning" onclick="exportBasicData()">
                            ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <button class="btn btn-success" onclick="exportBasicDetailsToExcel()">
                            ğŸ“Š ØªØµØ¯ÙŠØ± Excel Ø¨Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </button>
                    </div>
                </div>

                <div id="basicLoading" class="loading">
                    <div class="spinner"></div>
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ...</p>
                </div>
            </div>

            <div id="advancedTab" class="tab-content">
                <div class="section">
                    <h3 class="section-title">
                        ğŸ“Š Ø±ÙØ¹ Excel Ø§Ù„ÙˆÙƒÙŠÙ„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø«Ù„Ø§Ø« Ø£Ø´Ù‡Ø±
                    </h3>
                    <div class="file-upload" id="advancedFileUpload">
                        <p>ğŸ“„ Ø§Ø³Ø­Ø¨ Ù…Ù„Ù Excel Ø£Ùˆ CSV Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                        <input type="file" id="advancedFileInput" accept=".xlsx,.xls,.csv" style="display: none;">
                    </div>
                    <div id="advancedFileName" class="success-message hidden"></div>
                </div>

                <div class="section">
                    <h3 class="section-title">
                         ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø«Ù„Ø§Ø« Ø£Ø´Ù‡Ø±
                    </h3>
                    <p style="color: #666; margin-bottom: 15px; font-size: 1rem;">
                         ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ 3 Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø®Ù„Ø§Ù„ 5 Ø£ÙŠØ§Ù…<br>
                         Ù…Ù‚Ø§Ø±Ù†Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§Ø¬Ø¹ Ù„Ù„ÙˆÙƒÙŠÙ„
                    </p>
                    <button class="btn btn-primary" onclick="analyzeAdvancedData()">
                         ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª
                    </button>
                    <button class="btn btn-warning" onclick="resetAdvancedResults()">
                         Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                    </button>
                </div>

                <div id="advancedResults" class="section hidden">
                    <h3 class="section-title">
                         ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø¨Ø§Ù„Øº 
                    </h3>
                    <div id="advancedAgentInfo" class="agent-info"></div>
                    <div class="results-grid" id="advancedResultsGrid"></div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveAdvancedReport()">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button class="btn btn-primary" onclick="printAdvancedReport()">
                            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button class="btn btn-warning" onclick="exportAdvancedData()">
                            ğŸ“¤ ØªØµØ¯ÙŠØ± Ù„Ù„ÙˆÙƒÙŠÙ„
                        </button>
                        <button class="btn btn-success" onclick="exportAdvancedDetailsToExcel()">
                            ğŸ“Š ØªØµØ¯ÙŠØ± Excel Ø¨Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </button>
                    </div>
                </div>

                <div id="advancedLoading" class="loading">
                    <div class="spinner"></div>
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø«Ù„Ø§Ø« Ø£Ø´Ù‡Ø±...</p>
                </div>
            </div>

            <div id="twoMonthsTab" class="tab-content">
                <div class="section">
                    <h3 class="section-title">
                        ğŸ“… Ø±ÙØ¹ Excel Ø§Ù„ÙˆÙƒÙŠÙ„ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ†
                    </h3>
                    <div class="file-upload" id="twoMonthsFileUpload">
                        <p>ğŸ“„ Ø§Ø³Ø­Ø¨ Ù…Ù„Ù Excel Ø£Ùˆ CSV Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                        <input type="file" id="twoMonthsFileInput" accept=".xlsx,.xls,.csv" style="display: none;">
                    </div>
                    <div id="twoMonthsFileName" class="success-message hidden"></div>
                </div>

                <div class="section">
                    <h3 class="section-title">
                         ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ†
                    </h3>
                    <p style="color: #666; margin-bottom: 15px; font-size: 1rem;">
                         ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ 2 Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø®Ù„Ø§Ù„ 5 Ø£ÙŠØ§Ù…<br>
                         Ù…Ù‚Ø§Ø±Ù†Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø§Ø¬Ø¹ Ù„Ù„ÙˆÙƒÙŠÙ„
                    </p>
                    <button class="btn btn-primary" onclick="analyzeTwoMonthsData()">
                         ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª
                    </button>
                    <button class="btn btn-warning" onclick="resetTwoMonthsResults()">
                         Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                    </button>
                </div>

                <div id="twoMonthsResults" class="section hidden">
                    <h3 class="section-title">
                         ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø¨Ø§Ù„Øº 
                    </h3>
                    <div id="twoMonthsAgentInfo" class="agent-info"></div>
                    <div class="results-grid" id="twoMonthsResultsGrid"></div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="saveTwoMonthsReport()">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button class="btn btn-primary" onclick="printTwoMonthsReport()">
                            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                        </button>
                        <button class="btn btn-warning" onclick="exportTwoMonthsData()">
                            ğŸ“¤ ØªØµØ¯ÙŠØ± Ù„Ù„ÙˆÙƒÙŠÙ„
                        </button>
                        <button class="btn btn-success" onclick="exportTwoMonthsDetailsToExcel()">
                            ğŸ“Š ØªØµØ¯ÙŠØ± Excel Ø¨Ø§Ù„ØªÙØ§ØµÙŠÙ„
                        </button>
                    </div>
                </div>

                <div id="twoMonthsLoading" class="loading">
                    <div class="spinner"></div>
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ†...</p>
                </div>
            </div>

            <div id="summaryTab" class="tab-content">
                <div class="section">
                    <h3 class="section-title">
                        ğŸ“‹ Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø§Ù… Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡
                    </h3>
                    <p style="color: #666; margin-bottom: 20px; font-size: 1rem;">
                        ÙŠØ¹Ø±Ø¶ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…Ù„Ø®Øµ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ ÙˆØ¹Ø±ÙˆØ¶Ù‡Ù… Ø§Ù„Ù…Ø­Ø³ÙˆØ¨Ø©
                    </p>
                    <button class="btn btn-primary" onclick="refreshSummary()">
                        ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ
                    </button>
                    <button class="btn btn-success" onclick="exportSummaryToExcel()">
                        ğŸ“Š ØªØµØ¯ÙŠØ± Excel Ù„Ù„Ù…Ù„Ø®Øµ
                    </button>
                    <button class="btn btn-warning" onclick="printSummaryReport()">
                        ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ù„Ø®Øµ
                    </button>
                </div>

                <div id="summaryResults" class="section">
                    <h3 class="section-title">
                        ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡
                    </h3>
                    <div id="summaryContent">
                        <p style="text-align: center; color: #999; padding: 40px;">
                            Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø£ÙˆÙ„Ø§Ù‹
                        </p>
                    </div>
                </div>

                <div id="summaryTotals" class="section hidden">
                    <h3 class="section-title">
                         Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                    </h3>
                    <div class="results-grid" id="summaryTotalsGrid"></div>
                </div>
            </div>

            <div id="settingsTab" class="tab-content">
                <div class="section">
                    <h3 class="section-title">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                    <div class="settings-container">
                        <div class="settings-section">
                            <h4> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</h4>
                            <div class="settings-group">
                                <label>Ø³Ø¹Ø± Bronze :</label>
                                <input type="number" id="priceBronze" class="settings-input" value="30000">
                            </div>
                            <div class="settings-group">
                                <label>Ø³Ø¹Ø± Silver:</label>
                                <input type="number" id="priceSilver" class="settings-input" value="40000">
                            </div>
                            <div class="settings-group">
                                <label>Ø³Ø¹Ø± Gold :</label>
                                <input type="number" id="priceGold" class="settings-input" value="50000">
                            </div>
                            <div class="settings-group">
                                <label>Ø³Ø¹Ø± Platinum :</label>
                                <input type="number" id="pricePlatinum" class="settings-input" value="65000">
                            </div>
                            <button class="btn btn-primary" onclick="savePriceSettings()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
                        </div>
                        <div class="settings-section">
                            <h4> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                            <button class="btn btn-success" onclick="backupData()">ğŸ’¾ Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
                            <button class="btn btn-warning" onclick="restoreData()">ğŸ“¥ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                            <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                        </div>
                        <div class="settings-section">
                            <h4>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h4>
                            <label class="settings-checkbox">
                                <input type="checkbox" id="enableNotifications" checked>
                                ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="activityTab" class="tab-content">
                <div class="section">
                    <h3 class="section-title">ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h3>
                    <div class="activity-controls" style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                        <input type="text" id="activitySearch" placeholder="ğŸ” Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„..." class="settings-input" style="flex: 1; min-width: 200px;" onkeyup="filterActivityLog()">
                        <button class="btn btn-primary" onclick="refreshActivityLog()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                        <button class="btn btn-success" onclick="exportActivityLog()">ğŸ“Š ØªØµØ¯ÙŠØ±</button>
                        <button class="btn btn-danger" onclick="clearActivityLog()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
                    </div>
                    <div id="activityLogContent" class="activity-log-container"></div>
                </div>
            </div>

            </div> 
        </div>
    </div>

    <script>

let agentReports = {};
        let currentUser = '';
        let basicData = null;
        let advancedData = null;
        let twoMonthsData = null;
        let twoMonthsDetails = []; 
        let advancedDetails = [];
        let basicDetails = [];

        const arabicMonths = [
            'ÙƒØ§Ù†ÙˆÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ø´Ø¨Ø§Ø·', 'Ø¢Ø°Ø§Ø±', 'Ù†ÙŠØ³Ø§Ù†', 'Ø£ÙŠØ§Ø±', 'Ø­Ø²ÙŠØ±Ø§Ù†',
            'ØªÙ…ÙˆØ²', 'Ø¢Ø¨', 'Ø£ÙŠÙ„ÙˆÙ„', 'ØªØ´Ø±ÙŠÙ† Ø§Ù„Ø£ÙˆÙ„', 'ØªØ´Ø±ÙŠÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ', 'ÙƒØ§Ù†ÙˆÙ† Ø§Ù„Ø£ÙˆÙ„'
        ];

        const subscriptionPrices = {
            basic: {
                'Iraqcell_Bronze_Profile_NEW': 30000,
                'Iraqcell_Silver_Profile_NEW': 40000,
                'Iraqcell_Gold_Profile_NEW': 50000,
                'Iraqcell_Platinum_Profile_NEW': 65000
            },
            advanced: {
                promo: {
                    'Iraqcell_Bronze_Profile_NEW': 75000,
                    'Iraqcell_Silver_Profile_NEW': 105000,
                    'Iraqcell_Gold_Profile_NEW': 120000,
                    'Iraqcell_Platinum_Profile_NEW': 165000
                },
                official: {
                    'Iraqcell_Bronze_Profile_NEW': 90000,
                    'Iraqcell_Silver_Profile_NEW': 120000,
                    'Iraqcell_Gold_Profile_NEW': 150000,
                    'Iraqcell_Platinum_Profile_NEW': 195000
                }
            },
            twoMonths: {
                promo: {
                    'Iraqcell_Bronze_Profile_NEW': 50000,
                    'Iraqcell_Silver_Profile_NEW': 70000, 
                    'Iraqcell_Gold_Profile_NEW': 80000, 
                    'Iraqcell_Platinum_Profile_NEW': 110000
                }
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            setupFileUploads();
           document.getElementById('dashboard').style.display = 'block';
document.getElementById('currentUser').textContent = '';

        });

        function setupLoginForm() {
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                if (validCredentials[username] && validCredentials[username] === password) {
                    currentUser = username;
                    document.getElementById('currentUser').textContent = username;
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    document.getElementById('loginError').classList.add('hidden');
                } else {
                    document.getElementById('loginError').classList.remove('hidden');
                }
            });
        }

        function logout() {
            currentUser = '';
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            resetBasicResults();
            resetAdvancedResults();
            resetTwoMonthsResults();
        }

        function updateCurrentDate() {
            const now = new Date();
            const arabicDate = formatArabicDate(now);
            document.getElementById('currentDateTime').textContent = arabicDate;
        }

        function formatArabicDate(date) {
            const day = date.getDate();
            const month = arabicMonths[date.getMonth()];
            const year = date.getFullYear();
            return `${day} ${month} ${year}`;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (event && event.target.closest('.nav-item')) {
                event.target.closest('.nav-item').classList.add('active');
            } else {
                const navItems = document.querySelectorAll('.nav-item');
                if (tabName === 'basic') navItems[0]?.classList.add('active');
                else if (tabName === 'advanced') navItems[1]?.classList.add('active');
                else if (tabName === 'twoMonths') navItems[2]?.classList.add('active');
                else if (tabName === 'summary') navItems[3]?.classList.add('active');
                else if (tabName === 'settings') navItems[4]?.classList.add('active');
                else if (tabName === 'activity') navItems[5]?.classList.add('active');
            }
            
            const tabElement = document.getElementById(tabName + 'Tab');
            if (tabElement) {
                tabElement.classList.add('active');
                
                if (tabName === 'summary') {
                    updateAgentSummary();
                } else if (tabName === 'activity') {
                    setTimeout(() => refreshActivityLog(), 100);
                }
            }
        }

        function setupFileUploads() {
            setupFileUpload('basic');
            setupFileUpload('advanced');
            setupFileUpload('twoMonths');
        }

        function setupFileUpload(type) {
            const uploadDiv = document.getElementById(type + 'FileUpload');
            const fileInput = document.getElementById(type + 'FileInput');
            
            uploadDiv.addEventListener('click', () => fileInput.click());
            
            uploadDiv.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadDiv.classList.add('dragover');
            });
            
            uploadDiv.addEventListener('dragleave', () => {
                uploadDiv.classList.remove('dragover');
            });
            
            uploadDiv.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadDiv.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0], type);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0], type);
                }
            });
        }

        function handleFileSelect(file, type) {
            const fileName = document.getElementById(type + 'FileName');
            fileName.textContent = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù: ${file.name}`;
            fileName.classList.remove('hidden');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (file.name.toLowerCase().endsWith('.csv')) {
                        Papa.parse(e.target.result, {
                            header: false,
                            skipEmptyLines: true,
                            complete: function(results) {
                                const processedData = convertArrayToObjects(results.data);
                                if (type === 'basic') {
                                    basicData = processedData;
                                } else if (type === 'advanced') {
                                    advancedData = processedData;
                                } else {
                                    twoMonthsData = processedData;
                                }
                                showSuccessMessage(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù CSV Ø¨Ù†Ø¬Ø§Ø­ - ${results.data.length} ØµÙ`);
                            }
                        });
                    } else if (file.name.toLowerCase().match(/\.(xlsx|xls)$/)) {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                            header: 1,
                            defval: "",
                            raw: false
                        });
                        
                        const processedData = convertArrayToObjects(jsonData);
                        
                        if (type === 'basic') {
                            basicData = processedData;
                        } else if (type === 'advanced') {
                            advancedData = processedData;
                        } else {
                            twoMonthsData = processedData;
                        }
                        
                        showSuccessMessage(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­ - ${jsonData.length} ØµÙ`);
                    } else {
                        alert('Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Excel (.xlsx, .xls) Ø£Ùˆ CSV');
                    }
                } catch (error) {
                    alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
                    console.error('File reading error:', error);
                }
            };
            
            if (file.name.toLowerCase().match(/\.(xlsx|xls)$/)) {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsText(file);
            }
        }

        function convertArrayToObjects(arrayData) {
            if (!arrayData || arrayData.length === 0) return [];
            
            const headers = arrayData[0];
            const result = [];
            
            for (let i = 1; i < arrayData.length; i++) {
                const obj = {};
                for (let j = 0; j < headers.length; j++) {
                    obj[`Column${String.fromCharCode(65 + j)}`] = arrayData[i][j] || '';
                    obj[j] = arrayData[i][j] || '';
                }
                result.push(obj);
            }
            
            return result;
        }

        function showSuccessMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'success-message';
            messageDiv.textContent = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.top = '20px';
            messageDiv.style.right = '20px';
            messageDiv.style.zIndex = '9999';
            messageDiv.style.maxWidth = '300px';
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 3000);
        }

        function analyzeBasicData() {
            if (!basicData) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            basicDetails = [];

            showLoading('basic');
            
            setTimeout(() => {
                try {
                    const results = processBasicData(basicData);
                    
                    if (results.total.count === 0) {
                        alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ§Ù„Ø­Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù.');
                        hideLoading('basic');
                        return;
                    }
                    
                    displayBasicResults(results);
                    hideLoading('basic');
                    showSuccessMessage(`ØªÙ… ØªØ­Ù„ÙŠÙ„ ${results.total.count} Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¬Ø§Ù†ÙŠ Ø¨Ù†Ø¬Ø§Ø­`);
                } catch (error) {
                    alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ: ' + error.message);
                    hideLoading('basic');
                }
            }, 1000);
        }

        function processBasicData(data) {
            const results = {
                bronze: { count: 0, amount: 0 },
                silver: { count: 0, amount: 0 },
                gold: { count: 0, amount: 0 },
                platinum: { count: 0, amount: 0 },
                total: { count: 0, amount: 0 },
                agentName: ''
            };

            if (data.length === 0) return results;

            results.agentName = data[0]['ColumnE'] || data[0][4] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            data.forEach(row => {
                const createdAt = row['ColumnA'] || row[0];
                const username = row['ColumnB'] || row[1];
                const subscription = row['ColumnH'] || row[7];
                const count = row['ColumnO'] || row[14];
                const agent = row['ColumnE'] || row[4] || '';

                if (!createdAt || !username || !subscription || count != 1) return;

                const subType = String(subscription).trim();
                const price = subscriptionPrices.basic[subType];

                if (price) {
                    basicDetails.push({
                        username: String(username).trim(),
                        subscription: subType,
                        agent: String(agent).trim(),
                        date: createdAt,
                        price: price,
                        type: 'Ù…Ø¬Ø§Ù†ÙŠ'
                    });

                    if (subType.includes('Bronze')) {
                        results.bronze.count++;
                        results.bronze.amount += price;
                    } else if (subType.includes('Silver')) {
                        results.silver.count++;
                        results.silver.amount += price;
                    } else if (subType.includes('Gold')) {
                        results.gold.count++;
                        results.gold.amount += price;
                    } else if (subType.includes('Platinum')) {
                        results.platinum.count++;
                        results.platinum.amount += price;
                    }
                }
            });

            results.total.count = results.bronze.count + results.silver.count + results.gold.count + results.platinum.count;
            results.total.amount = results.bronze.amount + results.silver.amount + results.gold.amount + results.platinum.amount;

            return results;
        }

        function displayBasicResults(results) {
            if (!agentReports[results.agentName]) {
                agentReports[results.agentName] = {};
            }
            agentReports[results.agentName].basic = results;

            const agentInfo = document.getElementById('basicAgentInfo');
            agentInfo.innerHTML = `
                <h3> Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</h3>
                <p><strong>Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„:</strong> ${results.agentName}</p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> ${formatArabicDate(new Date())}</p>
                <p><strong>Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</p>
            `;

            const resultsGrid = document.getElementById('basicResultsGrid');
            resultsGrid.innerHTML = `
                <div class="result-card bronze">
                    <h3>ğŸ¥‰ Bronze</h3>
                    <div class="count">${results.bronze.count}</div>
                    <div class="amount">${formatNumber(results.bronze.amount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card silver">
                    <h3>ğŸ¥ˆ Silver</h3>
                    <div class="count">${results.silver.count}</div>
                    <div class="amount">${formatNumber(results.silver.amount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card gold">
                    <h3>ğŸ¥‡ Gold</h3>
                    <div class="count">${results.gold.count}</div>
                    <div class="amount">${formatNumber(results.gold.amount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card platinum">
                    <h3>ğŸ’ Platinum</h3>
                    <div class="count">${results.platinum.count}</div>
                    <div class="amount">${formatNumber(results.platinum.amount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card">
                    <h3>ğŸ“Š Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</h3>
                    <div class="count">${results.total.count}</div>
                    <div class="amount">${formatNumber(results.total.amount)} Ø¯.Ø¹</div>
                </div>
            `;

            document.getElementById('basicResults').classList.remove('hidden');
            
            updateAgentSummary();
            logActivity('ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ', `ØªÙ… ØªØ­Ù„ÙŠÙ„ ${results.total.count} Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¬Ø§Ù†ÙŠ Ù„Ù„ÙˆÙƒÙŠÙ„ ${results.agentName}`);
        }

        function analyzeAdvancedData() {
            if (!advancedData) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            advancedDetails = [];

            showLoading('advanced');
            
            setTimeout(() => {
                try {
                    const results = processAdvancedData(advancedData);
                    
                    if (results.total.count === 0) {
                        alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙØ¹ÙŠÙ„Ø§Øª ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ 3 Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø®Ù„Ø§Ù„ 5 Ø£ÙŠØ§Ù… Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….');
                        hideLoading('advanced');
                        return;
                    }
                    
                    displayAdvancedResults(results);
                    hideLoading('advanced');
                    showSuccessMessage(`ØªÙ… ØªØ­Ù„ÙŠÙ„ ${results.total.count} ØªÙØ¹ÙŠÙ„ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ø¨Ù†Ø¬Ø§Ø­`);
                } catch (error) {
                    alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶: ' + error.message);
                    hideLoading('advanced');
                }
            }, 1500);
        }

        function processAdvancedData(data) {
            const results = {
                bronze: { count: 0, promoAmount: 0, officialAmount: 0 },
                silver: { count: 0, promoAmount: 0, officialAmount: 0 },
                gold: { count: 0, promoAmount: 0, officialAmount: 0 },
                platinum: { count: 0, promoAmount: 0, officialAmount: 0 },
                total: { count: 0, promoAmount: 0, officialAmount: 0, profit: 0 },
                agentName: ''
            };

            if (data.length === 0) return results;

            results.agentName = data[0]['ColumnE'] || data[0][4] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            const userSubscriptions = {};
            const subscriptionDetails = {};

            data.forEach(row => {
                const createdAt = row['ColumnA'] || row[0];
                const username = row['ColumnB'] || row[1];
                const subscription = row['ColumnH'] || row[7];
                const agent = row['ColumnE'] || row[4] || '';

                if (!createdAt || !username || !subscription) return;

                let dateObj;
                try {
                    if (createdAt instanceof Date) {
                        dateObj = createdAt;
                    } else {
                        if (typeof createdAt === 'number' && createdAt > 40000) {
                            dateObj = new Date((createdAt - 25569) * 86400 * 1000);
                        } else {
                            dateObj = new Date(createdAt);
                        }
                    }
                    
                    if (isNaN(dateObj.getTime())) {
                        return;
                    }
                } catch (e) {
                    return;
                }

                const key = `${String(username).trim()}|${String(subscription).trim()}`;
                if (!userSubscriptions[key]) {
                    userSubscriptions[key] = [];
                    subscriptionDetails[key] = [];
                }
                userSubscriptions[key].push(dateObj);
                subscriptionDetails[key].push({
                    date: dateObj,
                    dateStr: createdAt,
                    username: String(username).trim(),
                    subscription: String(subscription).trim(),
                    agent: String(agent).trim()
                });
            });

            Object.keys(userSubscriptions).forEach(key => {
                const [username, subscription] = key.split('|');
                const dates = userSubscriptions[key].sort((a, b) => a - b);
                const details = subscriptionDetails[key];
                
                let activations = 0;
                const used = new Array(dates.length).fill(false);
                const activationDetails = [];

                let found = true;
                while (found) {
                    found = false;
                for (let i = 0; i < dates.length - 2; i++) {
                    if (used[i]) continue;
                    
                    for (let j = i + 1; j < dates.length - 1; j++) {
                        if (used[j]) continue;
                        
                        for (let k = j + 1; k < dates.length; k++) {
                            if (used[k]) continue;
                            
                            const daysDiff = (dates[k] - dates[i]) / (1000 * 60 * 60 * 24);
                            if (daysDiff <= 5) {
                                used[i] = used[j] = used[k] = true;
                                activations++;
                                    
                                    activationDetails.push({
                                        username: details[i].username,
                                        subscription: details[i].subscription,
                                        agent: details[i].agent,
                                        date1: details[i].dateStr,
                                        date2: details[j].dateStr,
                                        date3: details[k].dateStr,
                                        daysDiff: Math.round(daysDiff * 100) / 100,
                                        type: 'Ø«Ù„Ø§Ø« Ø£Ø´Ù‡Ø±'
                                    });
                                    
                                    found = true;
                                break;
                            }
                        }
                            if (found) break;
                        }
                        if (found) break;
                    }
                }
                
                advancedDetails.push(...activationDetails);

                if (activations > 0) {
                    const subType = subscription.trim();
                    const promoPrice = subscriptionPrices.advanced.promo[subType] || 0;
                    const officialPrice = subscriptionPrices.advanced.official[subType] || 0;

                    if (subType.includes('Bronze')) {
                        results.bronze.count += activations;
                        results.bronze.promoAmount += activations * promoPrice;
                        results.bronze.officialAmount += activations * officialPrice;
                    } else if (subType.includes('Silver')) {
                        results.silver.count += activations;
                        results.silver.promoAmount += activations * promoPrice;
                        results.silver.officialAmount += activations * officialPrice;
                    } else if (subType.includes('Gold')) {
                        results.gold.count += activations;
                        results.gold.promoAmount += activations * promoPrice;
                        results.gold.officialAmount += activations * officialPrice;
                    } else if (subType.includes('Platinum')) {
                        results.platinum.count += activations;
                        results.platinum.promoAmount += activations * promoPrice;
                        results.platinum.officialAmount += activations * officialPrice;
                    }
                }
            });

            results.total.count = results.bronze.count + results.silver.count + results.gold.count + results.platinum.count;
            results.total.promoAmount = results.bronze.promoAmount + results.silver.promoAmount + results.gold.promoAmount + results.platinum.promoAmount;
            results.total.officialAmount = results.bronze.officialAmount + results.silver.officialAmount + results.gold.officialAmount + results.platinum.officialAmount;
            results.total.profit = results.total.officialAmount - results.total.promoAmount;

            return results;
        }

        function displayAdvancedResults(results) {
            if (!agentReports[results.agentName]) {
                agentReports[results.agentName] = {};
            }
            agentReports[results.agentName].advanced = results;

            const agentInfo = document.getElementById('advancedAgentInfo');
            agentInfo.innerHTML = `
                <h3>Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø«Ù„Ø§Ø« Ø£Ø´Ù‡Ø±</h3>
                <p><strong>Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„:</strong> ${results.agentName}</p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> ${formatArabicDate(new Date())}</p>
                <p><strong>Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø«Ù„Ø§Ø« Ø£Ø´Ù‡Ø±</p>
                <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø§Ø¬Ø¹ Ù„Ù„ÙˆÙƒÙŠÙ„ :</strong> ${formatNumber(results.total.profit)} Ø¯.Ø¹</p>
            `;

            const resultsGrid = document.getElementById('advancedResultsGrid');
            resultsGrid.innerHTML = `
                <div class="result-card bronze">
                    <h3>ğŸ¥‰ Bronze</h3>
                    <div class="count">${results.bronze.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.bronze.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.bronze.officialAmount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card silver">
                    <h3>ğŸ¥ˆ Silver</h3>
                    <div class="count">${results.silver.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.silver.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.silver.officialAmount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card gold">
                    <h3>ğŸ¥‡ Gold</h3>
                    <div class="count">${results.gold.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.gold.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.gold.officialAmount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card platinum">
                    <h3>ğŸ’ Platinum</h3>
                    <div class="count">${results.platinum.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.platinum.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.platinum.officialAmount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card">
                    <h3>ğŸ“Š Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</h3>
                    <div class="count">${results.total.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.total.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.total.officialAmount)} Ø¯.Ø¹</div>
                </div>
            `;

            document.getElementById('advancedResults').classList.remove('hidden');
            
            updateAgentSummary();
            logActivity('ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - 3 Ø£Ø´Ù‡Ø±', `ØªÙ… ØªØ­Ù„ÙŠÙ„ ${results.total.count} ØªÙØ¹ÙŠÙ„ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ 3 Ø£Ø´Ù‡Ø± Ù„Ù„ÙˆÙƒÙŠÙ„ ${results.agentName}`);
        }

        function analyzeTwoMonthsData() {
            if (!twoMonthsData) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            twoMonthsDetails = [];

            showLoading('twoMonths');
            
            setTimeout(() => {
                try {
                    const results = processTwoMonthsData(twoMonthsData);
                    
                    if (results.total.count === 0) {
                        alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªÙØ¹ÙŠÙ„Ø§Øª ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ†. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ 2 Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø®Ù„Ø§Ù„ 5 Ø£ÙŠØ§Ù… Ù„Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….');
                        hideLoading('twoMonths');
                        return;
                    }
                    
                    displayTwoMonthsResults(results);
                    hideLoading('twoMonths');
                    showSuccessMessage(`ØªÙ… ØªØ­Ù„ÙŠÙ„ ${results.total.count} ØªÙØ¹ÙŠÙ„ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­`);
                } catch (error) {
                    alert('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ†: ' + error.message);
                    hideLoading('twoMonths');
                }
            }, 1500);
        }

        function processTwoMonthsData(data) {
            const results = {
                bronze: { count: 0, promoAmount: 0, officialAmount: 0 },
                silver: { count: 0, promoAmount: 0, officialAmount: 0 },
                gold: { count: 0, promoAmount: 0, officialAmount: 0 },
                platinum: { count: 0, promoAmount: 0, officialAmount: 0 },
                total: { count: 0, promoAmount: 0, officialAmount: 0, profit: 0 },
                agentName: ''
            };

            if (data.length === 0) return results;

            results.agentName = data[0]['ColumnE'] || data[0][4] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            const userSubscriptions = {};
            const subscriptionDetails = {};

            data.forEach(row => {
                const createdAt = row['ColumnA'] || row[0];
                const username = row['ColumnB'] || row[1];
                const subscription = row['ColumnH'] || row[7];
                const agent = row['ColumnE'] || row[4] || '';

                if (!createdAt || !username || !subscription) return;

                let dateObj;
                try {
                    if (createdAt instanceof Date) {
                        dateObj = createdAt;
                    } else {
                        if (typeof createdAt === 'number' && createdAt > 40000) {
                            dateObj = new Date((createdAt - 25569) * 86400 * 1000);
                        } else {
                            dateObj = new Date(createdAt);
                        }
                    }
                    
                    if (isNaN(dateObj.getTime())) {
                        return;
                    }
                } catch (e) {
                    return;
                }

                const key = `${String(username).trim()}|${String(subscription).trim()}`;
                if (!userSubscriptions[key]) {
                    userSubscriptions[key] = [];
                    subscriptionDetails[key] = [];
                }
                userSubscriptions[key].push(dateObj);
                subscriptionDetails[key].push({
                    date: dateObj,
                    dateStr: createdAt,
                    username: String(username).trim(),
                    subscription: String(subscription).trim(),
                    agent: String(agent).trim()
                });
            });

            Object.keys(userSubscriptions).forEach(key => {
                const [username, subscription] = key.split('|');
                let dates = userSubscriptions[key].sort((a, b) => a - b);
                
                const usedForThreeMonths = new Array(dates.length).fill(false);
                
                let foundThreeMonths = true;
                while (foundThreeMonths) {
                    foundThreeMonths = false;
                    for (let i = 0; i < dates.length - 2; i++) {
                        if (usedForThreeMonths[i]) continue;
                        
                        for (let j = i + 1; j < dates.length - 1; j++) {
                            if (usedForThreeMonths[j]) continue;
                            
                            for (let k = j + 1; k < dates.length; k++) {
                                if (usedForThreeMonths[k]) continue;
                                
                                const daysDiff = (dates[k] - dates[i]) / (1000 * 60 * 60 * 24);
                                if (daysDiff <= 5) {
                                    usedForThreeMonths[i] = true;
                                    usedForThreeMonths[j] = true;
                                    usedForThreeMonths[k] = true;
                                    foundThreeMonths = true;
                                    break;
                                }
                            }
                            if (foundThreeMonths) break;
                        }
                        if (foundThreeMonths) break;
                    }
                }
                
                const remainingDates = dates.filter((date, index) => !usedForThreeMonths[index]);
                const remainingDetails = subscriptionDetails[key].filter((detail, index) => !usedForThreeMonths[index]);
                
                let activations = 0;
                const used = new Array(remainingDates.length).fill(false);
                const activationDetails = [];

                let found = true;
                while (found) {
                    found = false;
                    for (let i = 0; i < remainingDates.length - 1; i++) {
                    if (used[i]) continue;
                    
                        for (let j = i + 1; j < remainingDates.length; j++) {
                        if (used[j]) continue;
                        
                            const daysDiff = (remainingDates[j] - remainingDates[i]) / (1000 * 60 * 60 * 24);
                        if (daysDiff <= 5) {
                            used[i] = used[j] = true;
                            activations++;
                                
                                activationDetails.push({
                                    username: remainingDetails[i].username,
                                    subscription: remainingDetails[i].subscription,
                                    agent: remainingDetails[i].agent,
                                    date1: remainingDetails[i].dateStr,
                                    date2: remainingDetails[j].dateStr,
                                    daysDiff: Math.round(daysDiff * 100) / 100,
                                    type: 'Ø´Ù‡Ø±ÙŠÙ†'
                                });
                                
                                found = true;
                            break;
                        }
                        }
                        if (found) break;
                    }
                }
                
                twoMonthsDetails.push(...activationDetails);

                if (activations > 0) {
                    const subType = subscription.trim();
                    const promoPrice = subscriptionPrices.twoMonths.promo[subType] || 0;
                    const monthlyOfficialPrice = subscriptionPrices.basic[subType] || 0;
                    const officialPrice = monthlyOfficialPrice * 2;

                    if (subType.includes('Bronze')) {
                        results.bronze.count += activations;
                        results.bronze.promoAmount += activations * promoPrice;
                        results.bronze.officialAmount += activations * officialPrice;
                    } else if (subType.includes('Silver')) {
                        results.silver.count += activations;
                        results.silver.promoAmount += activations * promoPrice;
                        results.silver.officialAmount += activations * officialPrice;
                    } else if (subType.includes('Gold')) {
                        results.gold.count += activations;
                        results.gold.promoAmount += activations * promoPrice;
                        results.gold.officialAmount += activations * officialPrice;
                    } else if (subType.includes('Platinum')) {
                        results.platinum.count += activations;
                        results.platinum.promoAmount += activations * promoPrice;
                        results.platinum.officialAmount += activations * officialPrice;
                    }
                }
            });

            results.total.count = results.bronze.count + results.silver.count + results.gold.count + results.platinum.count;
            results.total.promoAmount = results.bronze.promoAmount + results.silver.promoAmount + results.gold.promoAmount + results.platinum.promoAmount;
            results.total.officialAmount = results.bronze.officialAmount + results.silver.officialAmount + results.gold.officialAmount + results.platinum.officialAmount;
            results.total.profit = results.total.officialAmount - results.total.promoAmount;

            return results;
        }

        function displayTwoMonthsResults(results) {
            if (!agentReports[results.agentName]) {
                agentReports[results.agentName] = {};
            }
            agentReports[results.agentName].twoMonths = results;

            const agentInfo = document.getElementById('twoMonthsAgentInfo');
            agentInfo.innerHTML = `
                <h3>Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ†</h3>
                <p><strong>Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„:</strong> ${results.agentName}</p>
                <p><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> ${formatArabicDate(new Date())}</p>
                <p><strong>Ù†ÙˆØ¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ†</p>
                <p><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø§Ø¬Ø¹ Ù„Ù„ÙˆÙƒÙŠÙ„ :</strong> ${formatNumber(results.total.profit)} Ø¯.Ø¹</p>
            `;

            const resultsGrid = document.getElementById('twoMonthsResultsGrid');
            resultsGrid.innerHTML = `
                <div class="result-card bronze">
                    <h3>ğŸ¥‰ Bronze</h3>
                    <div class="count">${results.bronze.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.bronze.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.bronze.officialAmount)} Ø¯.Ø¹</div>
                    <div class="amount" style="color: #28a745; font-weight: 700; margin-top: 5px;">Ø±Ø§Ø¬Ø¹: ${formatNumber(results.bronze.officialAmount - results.bronze.promoAmount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card silver">
                    <h3>ğŸ¥ˆ Silver</h3>
                    <div class="count">${results.silver.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.silver.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.silver.officialAmount)} Ø¯.Ø¹</div>
                    <div class="amount" style="color: #28a745; font-weight: 700; margin-top: 5px;">Ø±Ø§Ø¬Ø¹: ${formatNumber(results.silver.officialAmount - results.silver.promoAmount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card gold">
                    <h3>ğŸ¥‡ Gold</h3>
                    <div class="count">${results.gold.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.gold.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.gold.officialAmount)} Ø¯.Ø¹</div>
                    <div class="amount" style="color: #28a745; font-weight: 700; margin-top: 5px;">Ø±Ø§Ø¬Ø¹: ${formatNumber(results.gold.officialAmount - results.gold.promoAmount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card platinum">
                    <h3>ğŸ’ Platinum</h3>
                    <div class="count">${results.platinum.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.platinum.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.platinum.officialAmount)} Ø¯.Ø¹</div>
                    <div class="amount" style="color: #28a745; font-weight: 700; margin-top: 5px;">Ø±Ø§Ø¬Ø¹: ${formatNumber(results.platinum.officialAmount - results.platinum.promoAmount)} Ø¯.Ø¹</div>
                </div>
                <div class="result-card">
                    <h3>ğŸ“Š Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</h3>
                    <div class="count">${results.total.count}</div>
                    <div class="amount">Ø¹Ø±Ø¶: ${formatNumber(results.total.promoAmount)} Ø¯.Ø¹</div>
                    <div class="amount">Ø±Ø³Ù…ÙŠ: ${formatNumber(results.total.officialAmount)} Ø¯.Ø¹</div>
                    <div class="amount" style="color: #28a745; font-weight: 700; margin-top: 5px; font-size: 1.2rem;">Ø±Ø§Ø¬Ø¹ Ø§Ù„ÙƒÙ„ÙŠ: ${formatNumber(results.total.profit)} Ø¯.Ø¹</div>
                </div>
            `;

            document.getElementById('twoMonthsResults').classList.remove('hidden');
            
            updateAgentSummary();
            logActivity('ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø´Ù‡Ø±ÙŠÙ†', `ØªÙ… ØªØ­Ù„ÙŠÙ„ ${results.total.count} ØªÙØ¹ÙŠÙ„ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ø´Ù‡Ø±ÙŠÙ† Ù„Ù„ÙˆÙƒÙŠÙ„ ${results.agentName}`);
        }

        function showLoading(type) {
            document.getElementById(type + 'Loading').style.display = 'block';
        }

        function hideLoading(type) {
            document.getElementById(type + 'Loading').style.display = 'none';
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ar-IQ').format(num);
        }

        function resetBasicResults() {
            document.getElementById('basicResults').classList.add('hidden');
            document.getElementById('basicFileName').classList.add('hidden');
            document.getElementById('basicFileInput').value = '';
            basicData = null;
        }

        function resetAdvancedResults() {
            document.getElementById('advancedResults').classList.add('hidden');
            document.getElementById('advancedFileName').classList.add('hidden');
            document.getElementById('advancedFileInput').value = '';
            advancedData = null;
        }

        function resetTwoMonthsResults() {
            document.getElementById('twoMonthsResults').classList.add('hidden');
            document.getElementById('twoMonthsFileName').classList.add('hidden');
            document.getElementById('twoMonthsFileInput').value = '';
            twoMonthsData = null;
        }

        function saveBasicReport() {
            if (!basicData || document.getElementById('basicResults').classList.contains('hidden')) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ø­ÙØ¸Ù‡Ø§. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            const results = processBasicData(basicData);
            const csvContent = generateBasicReportCSV(results);
            downloadCSV(csvContent, `ØªÙ‚Ø±ÙŠØ±_Ø£Ø³Ø§Ø³ÙŠ_${results.agentName}_${formatDateForFilename(new Date())}.csv`);
            
            
if (!agentReports[results.agentName]) {
    agentReports[results.agentName] = { basic: null, advanced: null, twoMonths: null };
}
agentReports[results.agentName].basic = results;
updateAgentSummary();
alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!');

        }

        function saveAdvancedReport() {
            if (!advancedData || document.getElementById('advancedResults').classList.contains('hidden')) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ø­ÙØ¸Ù‡Ø§. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            const results = processAdvancedData(advancedData);
            const csvContent = generateAdvancedReportCSV(results);
            downloadCSV(csvContent, `ØªÙ‚Ø±ÙŠØ±_ØªÙØ¹ÙŠÙ„Ø§Øª_${results.agentName}_${formatDateForFilename(new Date())}.csv`);
            
            
if (!agentReports[results.agentName]) {
    agentReports[results.agentName] = { basic: null, advanced: null, twoMonths: null };
}
agentReports[results.agentName].advanced = results;
updateAgentSummary();
alert('ØªÙ… Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');

        }

        function saveTwoMonthsReport() {
            if (!twoMonthsData || document.getElementById('twoMonthsResults').classList.contains('hidden')) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ø­ÙØ¸Ù‡Ø§. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            const results = processTwoMonthsData(twoMonthsData);
            const csvContent = generateTwoMonthsReportCSV(results);
            downloadCSV(csvContent, `ØªÙ‚Ø±ÙŠØ±_Ø´Ù‡Ø±ÙŠÙ†_${results.agentName}_${formatDateForFilename(new Date())}.csv`);
            
            if (!agentReports[results.agentName]) {
                agentReports[results.agentName] = { basic: null, advanced: null, twoMonths: null };
            }
            agentReports[results.agentName].twoMonths = results;
            updateAgentSummary();
            alert('ØªÙ… Ø­ÙØ¸ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function generateBasicReportCSV(results) {
            const header = 'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ,Ø§Ù„Ø¹Ø¯Ø¯,Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯.Ø¹)\n';
            const rows = [
                `Bronze,${results.bronze.count},${results.bronze.amount}`,
                `Silver,${results.silver.count},${results.silver.amount}`,
                `Gold,${results.gold.count},${results.gold.amount}`,
                `Platinum,${results.platinum.count},${results.platinum.amount}`,
                `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹,${results.total.count},${results.total.amount}`
            ].join('\n');
            
            return header + rows;
        }

        function generateAdvancedReportCSV(results) {
            const header = 'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ,Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª,Ù…Ø¨Ù„Øº Ø§Ù„Ø¹Ø±Ø¶ (Ø¯.Ø¹),Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ø³Ù…ÙŠ (Ø¯.Ø¹),Ø§Ù„Ø±Ø¨Ø­ (Ø¯.Ø¹)\n';
            const rows = [
                `Bronze,${results.bronze.count},${results.bronze.promoAmount},${results.bronze.officialAmount},${results.bronze.officialAmount - results.bronze.promoAmount}`,
                `Silver,${results.silver.count},${results.silver.promoAmount},${results.silver.officialAmount},${results.silver.officialAmount - results.silver.promoAmount}`,
                `Gold,${results.gold.count},${results.gold.promoAmount},${results.gold.officialAmount},${results.gold.officialAmount - results.gold.promoAmount}`,
                `Platinum,${results.platinum.count},${results.platinum.promoAmount},${results.platinum.officialAmount},${results.platinum.officialAmount - results.platinum.promoAmount}`,
                `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹,${results.total.count},${results.total.promoAmount},${results.total.officialAmount},${results.total.profit}`
            ].join('\n');
            
            return header + rows;
        }

        function generateTwoMonthsReportCSV(results) {
            const header = 'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ,Ø¹Ø¯Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª,Ù…Ø¨Ù„Øº Ø§Ù„Ø¹Ø±Ø¶ (Ø¯.Ø¹),Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ø³Ù…ÙŠ (Ø¯.Ø¹),Ø§Ù„Ø±Ø¨Ø­ (Ø¯.Ø¹)\n';
            const rows = [
                `Bronze,${results.bronze.count},${results.bronze.promoAmount},${results.bronze.officialAmount},${results.bronze.officialAmount - results.bronze.promoAmount}`,
                `Silver,${results.silver.count},${results.silver.promoAmount},${results.silver.officialAmount},${results.silver.officialAmount - results.silver.promoAmount}`,
                `Gold,${results.gold.count},${results.gold.promoAmount},${results.gold.officialAmount},${results.gold.officialAmount - results.gold.promoAmount}`,
                `Platinum,${results.platinum.count},${results.platinum.promoAmount},${results.platinum.officialAmount},${results.platinum.officialAmount - results.platinum.promoAmount}`,
                `Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹,${results.total.count},${results.total.promoAmount},${results.total.officialAmount},${results.total.profit}`
            ].join('\n');
            
            return header + rows;
        }

        function downloadCSV(content, filename) {
            const blob = new Blob(['\ufeff' + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function formatDateForFilename(date) {
            return date.toISOString().split('T')[0];
        }

        function printBasicReport() {
            if (document.getElementById('basicResults').classList.contains('hidden')) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            window.print();
        }

        function printAdvancedReport() {
            if (document.getElementById('advancedResults').classList.contains('hidden')) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            window.print();
        }

        function printTwoMonthsReport() {
            if (document.getElementById('twoMonthsResults').classList.contains('hidden')) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            window.print();
        }

        function exportBasicData() {
            if (!basicData) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            const filteredData = basicData.filter(row => {
                const count = row['ColumnO'] || row[14];
                return count == 1;
            });
            
            const csvContent = convertDataToCSV(filteredData);
            downloadCSV(csvContent, `Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ù…ÙÙ„ØªØ±Ø©_${formatDateForFilename(new Date())}.csv`);
            alert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function exportAdvancedData() {
            if (!advancedData) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            const results = processAdvancedData(advancedData);
            const csvContent = generateAdvancedReportCSV(results);
            downloadCSV(csvContent, `ØªÙ‚Ø±ÙŠØ±_ÙˆÙƒÙŠÙ„_${results.agentName}_${formatDateForFilename(new Date())}.csv`);
            alert('ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function exportTwoMonthsData() {
            if (!twoMonthsData) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            
            const results = processTwoMonthsData(twoMonthsData);
            const csvContent = generateTwoMonthsReportCSV(results);
            downloadCSV(csvContent, `ØªÙ‚Ø±ÙŠØ±_Ø´Ù‡Ø±ÙŠÙ†_ÙˆÙƒÙŠÙ„_${results.agentName}_${formatDateForFilename(new Date())}.csv`);
            alert('ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ù„Ø´Ù‡Ø±ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function exportTwoMonthsDetailsToExcel() {
            if (!twoMonthsDetails || twoMonthsDetails.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ù„Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }

            try {
                const wb = XLSX.utils.book_new();
                
                const excelData = twoMonthsDetails.map((detail, index) => ({
                    'Ø±Ù‚Ù…': index + 1,
                    'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…': detail.username,
                    'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ': detail.subscription,
                    'Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„': detail.agent,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø£ÙˆÙ„': detail.date1,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø«Ø§Ù†ÙŠ': detail.date2,
                    'Ø§Ù„ÙØ±Ù‚ Ø¨Ø§Ù„Ø£ÙŠØ§Ù…': detail.daysDiff,
                    'Ù†ÙˆØ¹ Ø§Ù„ØªÙØ¹ÙŠÙ„': detail.type,
                    'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø®ÙØ¶ (Ø¯.Ø¹)': subscriptionPrices.twoMonths.promo[detail.subscription] || 0,
                    'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ (Ø¯.Ø¹)': (subscriptionPrices.basic[detail.subscription] || 0) * 2,
                    'Ø§Ù„Ø±Ø§Ø¬Ø¹ Ù„Ù„ÙˆÙƒÙŠÙ„ (Ø¯.Ø¹)': ((subscriptionPrices.basic[detail.subscription] || 0) * 2) - (subscriptionPrices.twoMonths.promo[detail.subscription] || 0)
                }));

                const ws = XLSX.utils.json_to_sheet(excelData);
                
                ws['!cols'] = [
                    { wch: 8 },
                    { wch: 25 },
                    { wch: 30 },
                    { wch: 20 },
                    { wch: 20 },
                    { wch: 20 },
                    { wch: 12 },
                    { wch: 15 },
                    { wch: 18 },
                    { wch: 18 },
                    { wch: 18 }
                ];

                XLSX.utils.book_append_sheet(wb, ws, 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª');

                const agentName = twoMonthsDetails.length > 0 ? twoMonthsDetails[0].agent : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const filename = `ØªÙØ§ØµÙŠÙ„_Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª_Ø´Ù‡Ø±ÙŠÙ†_${agentName}_${formatDateForFilename(new Date())}.xlsx`;
                XLSX.writeFile(wb, filename);
                
                showSuccessMessage(`ØªÙ… ØªØµØ¯ÙŠØ± ${twoMonthsDetails.length} ØªÙØ¹ÙŠÙ„ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­!`);
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±: ' + error.message);
                console.error('Export error:', error);
            }
        }

        function exportAdvancedDetailsToExcel() {
            if (!advancedDetails || advancedDetails.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ù„Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }

            try {
                const wb = XLSX.utils.book_new();
                
                const excelData = advancedDetails.map((detail, index) => ({
                    'Ø±Ù‚Ù…': index + 1,
                    'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…': detail.username,
                    'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ': detail.subscription,
                    'Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„': detail.agent,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø£ÙˆÙ„': detail.date1,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø«Ø§Ù†ÙŠ': detail.date2,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø«Ø§Ù„Ø«': detail.date3,
                    'Ø§Ù„ÙØ±Ù‚ Ø¨Ø§Ù„Ø£ÙŠØ§Ù…': detail.daysDiff,
                    'Ù†ÙˆØ¹ Ø§Ù„ØªÙØ¹ÙŠÙ„': detail.type,
                    'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø®ÙØ¶ (Ø¯.Ø¹)': subscriptionPrices.advanced.promo[detail.subscription] || 0,
                    'Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø±Ø³Ù…ÙŠ (Ø¯.Ø¹)': subscriptionPrices.advanced.official[detail.subscription] || 0,
                    'Ø§Ù„Ø±Ø§Ø¬Ø¹ Ù„Ù„ÙˆÙƒÙŠÙ„ (Ø¯.Ø¹)': (subscriptionPrices.advanced.official[detail.subscription] || 0) - (subscriptionPrices.advanced.promo[detail.subscription] || 0)
                }));

                const ws = XLSX.utils.json_to_sheet(excelData);
                
                ws['!cols'] = [
                    { wch: 8 },
                    { wch: 25 },
                    { wch: 30 },
                    { wch: 20 },
                    { wch: 20 },
                    { wch: 20 },
                    { wch: 20 },
                    { wch: 12 },
                    { wch: 15 },
                    { wch: 18 },
                    { wch: 18 },
                    { wch: 18 }
                ];

                XLSX.utils.book_append_sheet(wb, ws, 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª');

                const agentName = advancedDetails.length > 0 ? advancedDetails[0].agent : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const filename = `ØªÙØ§ØµÙŠÙ„_Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª_Ø«Ù„Ø§Ø«_Ø£Ø´Ù‡Ø±_${agentName}_${formatDateForFilename(new Date())}.xlsx`;
                XLSX.writeFile(wb, filename);
                
                showSuccessMessage(`ØªÙ… ØªØµØ¯ÙŠØ± ${advancedDetails.length} ØªÙØ¹ÙŠÙ„ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­!`);
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±: ' + error.message);
                console.error('Export error:', error);
            }
        }

        function exportBasicDetailsToExcel() {
            if (!basicDetails || basicDetails.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙØ§ØµÙŠÙ„ Ù„Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }

            try {
                const wb = XLSX.utils.book_new();
                
                const excelData = basicDetails.map((detail, index) => ({
                    'Ø±Ù‚Ù…': index + 1,
                    'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…': detail.username,
                    'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ': detail.subscription,
                    'Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„': detail.agent,
                    'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ': detail.date,
                    'Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø±Ø¶': detail.type,
                    'Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯.Ø¹)': detail.price
                }));

                const ws = XLSX.utils.json_to_sheet(excelData);
                
                ws['!cols'] = [
                    { wch: 8 },
                    { wch: 25 },
                    { wch: 30 },
                    { wch: 20 },
                    { wch: 20 },
                    { wch: 15 },
                    { wch: 15 }
                ];

                XLSX.utils.book_append_sheet(wb, ws, 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª');

                const agentName = basicDetails.length > 0 ? basicDetails[0].agent : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                const filename = `ØªÙØ§ØµÙŠÙ„_Ø§Ù„Ø¹Ø±Ø¶_Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ_${agentName}_${formatDateForFilename(new Date())}.xlsx`;
                XLSX.writeFile(wb, filename);
                
                showSuccessMessage(`ØªÙ… ØªØµØ¯ÙŠØ± ${basicDetails.length} Ø§Ø´ØªØ±Ø§Ùƒ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­!`);
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±: ' + error.message);
                console.error('Export error:', error);
            }
        }

        function convertDataToCSV(data) {
            if (!data || data.length === 0) return '';
      
            const headers = ['Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'Ù†ÙˆØ¹ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ', 'Ø§Ù„ÙˆÙƒÙŠÙ„'];
            let csv = headers.join(',') + '\n';
    
            data.forEach(row => {
                const rowData = [
                    row['ColumnA'] || row[0] || '',
                    row['ColumnB'] || row[1] || '',
                    row['ColumnH'] || row[7] || '',
                    row['ColumnE'] || row[4] || ''
                ];
                csv += rowData.map(field => `"${field}"`).join(',') + '\n';
            });
            
            return csv;
        }
    
function updateAgentSummary() {
            if (!agentReports || Object.keys(agentReports).length === 0) {
                document.getElementById('summaryContent').innerHTML = `
                    <p style="text-align: center; color: #999; padding: 40px;">
                        Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø£ÙˆÙ„Ø§Ù‹
                    </p>
                `;
                document.getElementById('summaryTotals').classList.add('hidden');
                return;
            }

            let totalBasicAll = 0;
            let totalAdvancedAll = 0;
            let totalTwoMonthsAll = 0;
            let totalAllAgents = 0;

            let summaryHTML = `<div class="results-grid">`;
            
            const sortedAgents = Object.entries(agentReports).sort((a, b) => {
                let totalA = 0;
                let totalB = 0;
                
                if (a[1].basic && a[1].basic.total.amount > 0) totalA += a[1].basic.total.amount;
                if (a[1].advanced && a[1].advanced.total.profit > 0) totalA += a[1].advanced.total.profit;
                if (a[1].twoMonths && a[1].twoMonths.total.profit > 0) totalA += a[1].twoMonths.total.profit;
                
                if (b[1].basic && b[1].basic.total.amount > 0) totalB += b[1].basic.total.amount;
                if (b[1].advanced && b[1].advanced.total.profit > 0) totalB += b[1].advanced.total.profit;
                if (b[1].twoMonths && b[1].twoMonths.total.profit > 0) totalB += b[1].twoMonths.total.profit;
                
                return totalB - totalA;
            });

            sortedAgents.forEach(([agentName, report]) => {
        let totalBasic = report.basic?.total.amount || 0;
        let totalAdvanced = report.advanced?.total.profit || 0;
        let totalTwoMonths = report.twoMonths?.total.profit || 0;
                
                let totalAll = 0;
                let offersCount = 0;
                
                if (report.basic && totalBasic > 0) {
                    totalAll += totalBasic;
                    offersCount++;
                }
                if (report.advanced && totalAdvanced > 0) {
                    totalAll += totalAdvanced;
                    offersCount++;
                }
                if (report.twoMonths && totalTwoMonths > 0) {
                    totalAll += totalTwoMonths;
                    offersCount++;
                }

                totalBasicAll += totalBasic;
                totalAdvancedAll += totalAdvanced;
                totalTwoMonthsAll += totalTwoMonths;
                totalAllAgents += totalAll;
                
                let agentOffersHTML = '';
                if (report.basic && totalBasic > 0) {
                    agentOffersHTML += `<div class="amount">ğŸ’° Ù…Ø¬Ø§Ù†ÙŠ: ${formatNumber(totalBasic)} Ø¯.Ø¹</div>`;
                }
                if (report.advanced && totalAdvanced > 0) {
                    agentOffersHTML += `<div class="amount">ğŸ’¼ Ù…Ø®ÙØ¶ 3 Ø£Ø´Ù‡Ø±: ${formatNumber(totalAdvanced)} Ø¯.Ø¹</div>`;
                }
                if (report.twoMonths && totalTwoMonths > 0) {
                    agentOffersHTML += `<div class="amount">ğŸ“… Ù…Ø®ÙØ¶ Ø´Ù‡Ø±ÙŠÙ†: ${formatNumber(totalTwoMonths)} Ø¯.Ø¹</div>`;
                }

        summaryHTML += `
            <div class="result-card">
                <h3>ğŸ‘¤ ${agentName}</h3>
                        ${agentOffersHTML}
                        <div class="amount" style="font-weight: 800; font-size: 1rem; color: #667eea; margin-top: 10px; padding-top: 10px; border-top: 2px solid rgba(102, 126, 234, 0.3);">
                            ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${formatNumber(totalAll)} Ø¯.Ø¹
                        </div>
            </div>`;
    });
            summaryHTML += `</div>`;

            document.getElementById('summaryContent').innerHTML = summaryHTML;

            let totalsHTML = `
                <div class="result-card" style="border-top: 4px solid; border-image: linear-gradient(135deg, #667eea, #764ba2, #f093fb) 1;">
                    <h3>ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠ</h3>
                    <div class="count">${formatNumber(totalBasicAll)}</div>
                    <div class="amount">Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ</div>
                </div>
                <div class="result-card" style="border-top: 4px solid; border-image: linear-gradient(135deg, #667eea, #764ba2, #f093fb) 1;">
                    <h3>ğŸ’¼ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ 3 Ø£Ø´Ù‡Ø±</h3>
                    <div class="count">${formatNumber(totalAdvancedAll)}</div>
                    <div class="amount">Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ</div>
                </div>
                <div class="result-card" style="border-top: 4px solid; border-image: linear-gradient(135deg, #667eea, #764ba2, #f093fb) 1;">
                    <h3>ğŸ“… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®ÙØ¶ Ø´Ù‡Ø±ÙŠÙ†</h3>
                    <div class="count">${formatNumber(totalTwoMonthsAll)}</div>
                    <div class="amount">Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ</div>
                </div>
                <div class="result-card" style="border-top: 4px solid; border-image: linear-gradient(135deg, #667eea, #764ba2, #f093fb) 1;">
                    <h3>ğŸ“Š Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ</h3>
                    <div class="count" style="font-size: 2.5rem;">${formatNumber(totalAllAgents)}</div>
                    <div class="amount">Ø¯ÙŠÙ†Ø§Ø± Ø¹Ø±Ø§Ù‚ÙŠ</div>
                </div>
            `;

            document.getElementById('summaryTotalsGrid').innerHTML = totalsHTML;
            document.getElementById('summaryTotals').classList.remove('hidden');
        }

        function refreshSummary() {
            updateAgentSummary();
            showSuccessMessage('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function exportSummaryToExcel() {
            if (!agentReports || Object.keys(agentReports).length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }

            try {
                const wb = XLSX.utils.book_new();
                const agentData = [];
                
                const sortedAgents = Object.entries(agentReports).sort((a, b) => {
                    let totalA = 0;
                    let totalB = 0;
                    
                    if (a[1].basic && a[1].basic.total.amount > 0) totalA += a[1].basic.total.amount;
                    if (a[1].advanced && a[1].advanced.total.profit > 0) totalA += a[1].advanced.total.profit;
                    if (a[1].twoMonths && a[1].twoMonths.total.profit > 0) totalA += a[1].twoMonths.total.profit;
                    
                    if (b[1].basic && b[1].basic.total.amount > 0) totalB += b[1].basic.total.amount;
                    if (b[1].advanced && b[1].advanced.total.profit > 0) totalB += b[1].advanced.total.profit;
                    if (b[1].twoMonths && b[1].twoMonths.total.profit > 0) totalB += b[1].twoMonths.total.profit;
                    
                    return totalB - totalA;
                });

                let totalBronze = 0, totalSilver = 0, totalGold = 0, totalPlatinum = 0;
                let totalActivations = 0, totalOfferAmount = 0, totalOfficialAmount = 0, totalReturned = 0;

                sortedAgents.forEach(([agentName, report]) => {
                    const now = new Date();
                    const dateTime = `${now.getDate()}/${now.getMonth() + 1}/${now.getFullYear()} ${now.getHours()}:${String(now.getMinutes()).padStart(2, '0')}`;
                    
                    let bronzeCount = 0, silverCount = 0, goldCount = 0, platinumCount = 0;
                    let totalCount = 0, offerAmount = 0, officialAmount = 0, returned = 0;
                    
                    
                    if (report.basic) {
                        bronzeCount += report.basic.bronze?.count || 0;
                        silverCount += report.basic.silver?.count || 0;
                        goldCount += report.basic.gold?.count || 0;
                        platinumCount += report.basic.platinum?.count || 0;
                        totalCount += report.basic.total?.count || 0;
                        offerAmount += report.basic.total?.amount || 0;
                        officialAmount += report.basic.total?.amount || 0;
                        returned += report.basic.total?.amount || 0;
                    }
                    
                    if (report.advanced) {
                        bronzeCount += report.advanced.bronze?.count || 0;
                        silverCount += report.advanced.silver?.count || 0;
                        goldCount += report.advanced.gold?.count || 0;
                        platinumCount += report.advanced.platinum?.count || 0;
                        totalCount += report.advanced.total?.count || 0;
                        offerAmount += report.advanced.total?.promoAmount || 0;
                        officialAmount += report.advanced.total?.officialAmount || 0;
                        returned += report.advanced.total?.profit || 0;
                    }
                    
                    if (report.twoMonths) {
                        bronzeCount += report.twoMonths.bronze?.count || 0;
                        silverCount += report.twoMonths.silver?.count || 0;
                        goldCount += report.twoMonths.gold?.count || 0;
                        platinumCount += report.twoMonths.platinum?.count || 0;
                        totalCount += report.twoMonths.total?.count || 0;
                        offerAmount += report.twoMonths.total?.promoAmount || 0;
                        officialAmount += report.twoMonths.total?.officialAmount || 0;
                        returned += report.twoMonths.total?.profit || 0;
                    }

                    totalBronze += bronzeCount;
                    totalSilver += silverCount;
                    totalGold += goldCount;
                    totalPlatinum += platinumCount;
                    totalActivations += totalCount;
                    totalOfferAmount += offerAmount;
                    totalOfficialAmount += officialAmount;
                    totalReturned += returned;

                    agentData.push({
                        'Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„': agentName,
                        'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª': dateTime,
                        'Ø¹Ø¯Ø¯ - Ø¨Ø±ÙˆÙ†Ø²ÙŠ': bronzeCount,
                        'Ø¹Ø¯Ø¯ - Ø³Ù„ÙØ±': silverCount,
                        'Ø¹Ø¯Ø¯ - Ø°Ù‡Ø¨ÙŠ': goldCount,
                        'Ø¹Ø¯Ø¯ - Ø¨Ù„Ø§ØªÙŠÙ†ÙŠÙˆÙ…': platinumCount,
                        'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª': totalCount,
                        'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº (Ø¹Ø±Ø¶)': offerAmount,
                        'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ‚Ø·Ø¹ (Ø§Ù„Ø±Ø³Ù…ÙŠ)': officialAmount,
                        'Ø±Ø§Ø¬Ø¹ Ø§Ù„ÙˆÙƒÙŠÙ„': returned
                    });
                });

                const ws = XLSX.utils.json_to_sheet(agentData);
                
                ws['!cols'] = [
                     { wch: 18 },
                     { wch: 16 },
                     { wch: 11 },
                     { wch: 11 },
                     { wch: 11 },
                     { wch: 13 },
                     { wch: 14 },
                     { wch: 16 },
                     { wch: 18 },
                     { wch: 14 }
                ];
                
                const headerRange = XLSX.utils.decode_range(ws['!ref']);
                headerRange.e.c = headerRange.e.c || 9;
                
                const colNames = ['Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„', 'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª', 'Ø¹Ø¯Ø¯ - Ø¨Ø±ÙˆÙ†Ø²ÙŠ', 'Ø¹Ø¯Ø¯ - Ø³Ù„ÙØ±', 'Ø¹Ø¯Ø¯ - Ø°Ù‡Ø¨ÙŠ', 'Ø¹Ø¯Ø¯ - Ø¨Ù„Ø§ØªÙŠÙ†ÙŠÙˆÙ…', 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙØ¹ÙŠÙ„Ø§Øª', 'Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ù„Øº (Ø¹Ø±Ø¶)', 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ‚Ø·Ø¹ (Ø§Ù„Ø±Ø³Ù…ÙŠ)', 'Ø±Ø§Ø¬Ø¹ Ø§Ù„ÙˆÙƒÙŠÙ„'];
                
                for (let col = 0; col <= headerRange.e.c; col++) {
                    const cellAddress = XLSX.utils.encode_cell({ r: 0, c: col });
                    if (!ws[cellAddress]) {
                        ws[cellAddress] = { t: 's', v: colNames[col] || '' };
                    }
                    
                    ws[cellAddress].s = {
                        fill: {
                             fgColor: { rgb: "B8D4F0" }
                        },
                        font: {
                            bold: true,
                             sz: 14,
                            color: { rgb: "000000" }
                        },
                        alignment: {
                             horizontal: "center",
                            vertical: "center",
                            wrapText: true
                        },
                        border: {
                            top: { style: "medium", color: { rgb: "000000" } },
                            bottom: { style: "medium", color: { rgb: "000000" } },
                            left: { style: "medium", color: { rgb: "000000" } },
                            right: { style: "medium", color: { rgb: "000000" } }
                        }
                    };
                }
                
                for (let row = 1; row <= agentData.length; row++) {                    
                    const isEvenRow = row % 2 === 0;
                     const bgColor = isEvenRow ? "F2F2F2" : "FFFFFF";
                    
                    for (let col = 0; col <= headerRange.e.c; col++) {
                        const cellAddress = XLSX.utils.encode_cell({ r: row, c: col });
                        
                        if (!ws[cellAddress]) {
                            continue;
                        }
                         
                        if (ws[cellAddress].t === 'n' && col >= 2) {
                            ws[cellAddress].z = '#,##0';
                        }
                         
                        ws[cellAddress].s = {
                            fill: {
                                fgColor: { rgb: bgColor }
                            },
                            font: {
                                sz: 11,
                                color: { rgb: "000000" }
                            },
                            alignment: {
                                horizontal: "center",
                                vertical: "center"
                            },
                            border: {
                                top: { style: "thin", color: { rgb: "CCCCCC" } },
                                bottom: { style: "thin", color: { rgb: "CCCCCC" } },
                                left: { style: "thin", color: { rgb: "CCCCCC" } },
                                right: { style: "thin", color: { rgb: "CCCCCC" } }
                            }
                        };
                    }
                }
                
                if (!ws['!rows']) {
                    ws['!rows'] = [];
                }
                 ws['!rows'][0] = { hpt: 30 };

                XLSX.utils.book_append_sheet(wb, ws, 'Ù…Ù„Ø®Øµ Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡');

                const filename = `Ù…Ù„Ø®Øµ_Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡_${formatDateForFilename(new Date())}.xlsx`;
                XLSX.writeFile(wb, filename);
                
                showSuccessMessage(`ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ø®Øµ ${sortedAgents.length} ÙˆÙƒÙŠÙ„ Ø¥Ù„Ù‰ Ù…Ù„Ù Excel Ø¨Ù†Ø¬Ø§Ø­!`);
            } catch (error) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±: ' + error.message);
                console.error('Export error:', error);
            }
        }

        function printSummaryReport() {
            if (!agentReports || Object.keys(agentReports).length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©. ÙŠØ±Ø¬Ù‰ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆÙƒÙ„Ø§Ø¡ Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }

            updateAgentSummary();
            
            window.print();
        }

        function showAuthorInfo() {
            const popup = document.getElementById('authorInfoPopup');
            const overlay = document.getElementById('popupOverlay');
            popup.classList.add('show');
            overlay.classList.add('show');
        }

        function closeAuthorInfo() {
            const popup = document.getElementById('authorInfoPopup');
            const overlay = document.getElementById('popupOverlay');
            popup.classList.remove('show');
            overlay.classList.remove('show');
        }

        function copyToClipboard(text, label) {
            navigator.clipboard.writeText(text).then(() => {
                showSuccessMessage(`ØªÙ… Ù†Ø³Ø® ${label} Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©`);
            }).catch(() => {
                alert(`ØªÙ… Ù†Ø³Ø® ${label} Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©`);
            });
        }

        function openLink(url) {
            window.open(url, '_blank');
        }

        document.addEventListener('DOMContentLoaded', function() {
            const overlay = document.getElementById('popupOverlay');
            overlay.addEventListener('click', closeAuthorInfo);
            loadSettings();
            loadActivityLog();
        });

        // Activity Log System
        let activityLog = JSON.parse(localStorage.getItem('activityLog') || '[]');

        function logActivity(action, details) {
            const logEntry = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                action: action,
                details: details,
                user: currentUser || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'
            };
            activityLog.unshift(logEntry);
            if (activityLog.length > 1000) activityLog = activityLog.slice(0, 1000);
            localStorage.setItem('activityLog', JSON.stringify(activityLog));
        }

        function refreshActivityLog() {
            const container = document.getElementById('activityLogContent');
            if (!container) return;
            
            if (activityLog.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø©</p>';
                return;
            }

            let html = '';
            activityLog.forEach(log => {
                const date = new Date(log.timestamp);
                const timeStr = date.toLocaleString('ar-IQ', { 
                    year: 'numeric', month: 'long', day: 'numeric',
                    hour: '2-digit', minute: '2-digit' 
                });
                html += `
                    <div class="activity-item">
                        <span class="activity-icon">${getActivityIcon(log.action)}</span>
                        <div class="activity-details">
                            <strong>${log.action}</strong>
                            <div style="color: #666; font-size: 0.9rem; margin-top: 5px;">${log.details}</div>
                            <div class="activity-time">${timeStr} - ${log.user}</div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function getActivityIcon(action) {
            if (action.includes('ØªØ­Ù…ÙŠÙ„') || action.includes('Ø±ÙØ¹')) return 'ğŸ“¤';
            if (action.includes('ØªØ­Ù„ÙŠÙ„')) return 'ğŸ”';
            if (action.includes('ØªØµØ¯ÙŠØ±')) return 'ğŸ“Š';
            if (action.includes('Ø­ÙØ¸')) return 'ğŸ’¾';
            if (action.includes('Ø·Ø¨Ø§Ø¹Ø©')) return 'ğŸ–¨ï¸';
            if (action.includes('Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª')) return 'âš™ï¸';
            if (action.includes('Ù†Ø³Ø®')) return 'ğŸ’¾';
            if (action.includes('Ù…Ø³Ø­')) return 'ğŸ—‘ï¸';
            return 'ğŸ“';
        }

        function filterActivityLog() {
            const searchTerm = document.getElementById('activitySearch').value.toLowerCase();
            const container = document.getElementById('activityLogContent');
            const items = container.querySelectorAll('.activity-item');
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(searchTerm) ? 'flex' : 'none';
            });
        }

        function exportActivityLog() {
            if (activityLog.length === 0) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª Ù„Ù„ØªØµØ¯ÙŠØ±');
                return;
            }
            
            const wb = XLSX.utils.book_new();
            const excelData = activityLog.map(log => ({
                'Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª': new Date(log.timestamp).toLocaleString('ar-IQ'),
                'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': log.action,
                'Ø§Ù„ØªÙØ§ØµÙŠÙ„': log.details,
                'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…': log.user
            }));
            
            const ws = XLSX.utils.json_to_sheet(excelData);
            XLSX.utils.book_append_sheet(wb, ws, 'Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª');
            XLSX.writeFile(wb, `Ø³Ø¬Ù„_Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª_${formatDateForFilename(new Date())}.xlsx`);
            logActivity('ØªØµØ¯ÙŠØ± Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', 'ØªÙ… ØªØµØ¯ÙŠØ± Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø¥Ù„Ù‰ Excel');
            showSuccessMessage('ØªÙ… ØªØµØ¯ÙŠØ± Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function clearActivityLog() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§ØªØŸ')) {
                activityLog = [];
                localStorage.removeItem('activityLog');
                refreshActivityLog();
                logActivity('Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª', 'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª');
                showSuccessMessage('ØªÙ… Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª');
            }
        }

        // Settings Management
        function loadSettings() {
            const saved = JSON.parse(localStorage.getItem('appSettings') || '{}');
            if (saved.bronze) document.getElementById('priceBronze').value = saved.bronze;
            if (saved.silver) document.getElementById('priceSilver').value = saved.silver;
            if (saved.gold) document.getElementById('priceGold').value = saved.gold;
            if (saved.platinum) document.getElementById('pricePlatinum').value = saved.platinum;
            if (saved.notifications !== undefined) document.getElementById('enableNotifications').checked = saved.notifications;
        }

        function savePriceSettings() {
            const bronze = parseFloat(document.getElementById('priceBronze').value);
            const silver = parseFloat(document.getElementById('priceSilver').value);
            const gold = parseFloat(document.getElementById('priceGold').value);
            const platinum = parseFloat(document.getElementById('pricePlatinum').value);
            
            subscriptionPrices.basic['Iraqcell_Bronze_Profile_NEW'] = bronze;
            subscriptionPrices.basic['Iraqcell_Silver_Profile_NEW'] = silver;
            subscriptionPrices.basic['Iraqcell_Gold_Profile_NEW'] = gold;
            subscriptionPrices.basic['Iraqcell_Platinum_Profile_NEW'] = platinum;
            
            const settings = {
                bronze, silver, gold, platinum,
                notifications: document.getElementById('enableNotifications').checked
            };
            localStorage.setItem('appSettings', JSON.stringify(settings));
            logActivity('Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø±');
            showSuccessMessage('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
        }

        // Backup and Restore
        function backupData() {
            const backup = {
                timestamp: new Date().toISOString(),
                agentReports: agentReports,
                settings: JSON.parse(localStorage.getItem('appSettings') || '{}'),
                activityLog: activityLog
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `backup_${formatDateForFilename(new Date())}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            logActivity('Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            showSuccessMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
        }

        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const backup = JSON.parse(event.target.result);
                        if (backup.agentReports) agentReports = backup.agentReports;
                        if (backup.settings) localStorage.setItem('appSettings', JSON.stringify(backup.settings));
                        if (backup.activityLog) {
                            activityLog = backup.activityLog;
                            localStorage.setItem('activityLog', JSON.stringify(activityLog));
                        }
                        
                        loadSettings();
                        updateAgentSummary();
                        refreshActivityLog();
                        logActivity('Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
                        showSuccessMessage('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                    } catch (error) {
                        alert('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function clearAllData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!')) {
                agentReports = {};
                activityLog = [];
                localStorage.clear();
                logActivity('Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…');
                showSuccessMessage('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                location.reload();
            }
        }

        function loadActivityLog() {
            refreshActivityLog();
}

</script>

<div id="popupOverlay" class="popup-overlay"></div>
<div id="authorInfoPopup" class="author-info-popup">
    <button class="popup-close" onclick="closeAuthorInfo()">Ã—</button>
    <div class="popup-header">
        <h2></h2>
    </div>
    <div class="popup-content">
        <div class="info-item">
            <button class="info-action" onclick="copyToClipboard('Ameer Helwas', 'Ø§Ù„Ø§Ø³Ù…')">ğŸ“‹ Ù†Ø³Ø®</button>
            <span class="info-value">Ameer Helwas</span>
            <span class="info-text">Ø§Ù„Ø§Ø³Ù…:</span>
            <span class="info-icon">ğŸ‘¨â€ğŸ’»</span>
        </div>
        <div class="info-item">
            <button class="info-action" onclick="copyToClipboard('ameeralgaraawi@hotmail.com', 'Ø§Ù„Ø¨Ø±ÙŠØ¯')">ğŸ“‹ Ù†Ø³Ø®</button>
            <span class="info-value">ameeralgaraawi@hotmail.com</span>
            <span class="info-text">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</span>
            <span class="info-icon">ğŸ“§</span>
        </div>
        <div class="info-item">
            <button class="info-action" onclick="copyToClipboard('07701024143', 'Ø§Ù„Ù‡Ø§ØªÙ')">ğŸ“‹ Ù†Ø³Ø®</button>
            <span class="info-value">07701024143</span>
            <span class="info-text">Ø§Ù„Ù‡Ø§ØªÙ:</span>
            <span class="info-icon">ğŸ“±</span>
        </div>
        <div class="info-item">
            <span class="info-value">IRAQCELL</span>
            <span class="info-text">Ø§Ù„Ø´Ø±ÙƒØ©:</span>
            <span class="info-icon">ğŸ¢</span>
        </div>
    </div>
</div>

</body>
</html>
